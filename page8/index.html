<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      James Clancy &middot; This needs to be reorganized in the future.
    
  </title>

  
  <link rel="canonical" href="/page8/">
  

  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6FZ90LRCT8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6FZ90LRCT8');
    </script>
  
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Largely a mess of content. The idea is to generate content then refine sometime in the future.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="/">Home</a>
    








  
  
  

  
    

    

    
    

        

        
        <a class="sidebar-nav-item" href="/categories/bookreviews/">
          BookReviews
          (<span class="text-muted small font-weight-light">
              77
              
          </span>)
        </a>

        <!-- content count -->


    


    

  

  
  
  

  
    

    

    
    

        

        
        <a class="sidebar-nav-item" href="/categories/general/">
          General
          (<span class="text-muted small font-weight-light">
              2
              
          </span>)
        </a>

        <!-- content count -->


    


    

  

  
  
  

  

  
  
  

  
    

    

    
    

        

        
        <a class="sidebar-nav-item" href="/categories/projects/">
          Projects
          (<span class="text-muted small font-weight-light">
              38
              
          </span>)
        </a>

        <!-- content count -->


    
        
          
          
          <a class="sidebar-nav-item" 
              href="/categories/kafkaui/" style="padding-left:60px;">KafkaUI (<span class="text-muted small font-weight-light">
                1
                
              </span>)</a>

          
        
          
          
          <a class="sidebar-nav-item" 
              href="/categories/safecardgame/" style="padding-left:60px;">SafeCardGame (<span class="text-muted small font-weight-light">
                17
                
              </span>)</a>

          
        
          
          
          <a class="sidebar-nav-item" 
              href="/categories/wilkensavenue/" style="padding-left:60px;">WilkensAvenue (<span class="text-muted small font-weight-light">
                20
                
              </span>)</a>

          
        
    


    

  

  
  
  

  
    

    

    
    

        

        
        <a class="sidebar-nav-item" href="/categories/recipes/">
          Recipes
          (<span class="text-muted small font-weight-light">
              16
              
          </span>)
        </a>

        <!-- content count -->


    


    

  

  
  
  

  

  
  
  

  




  </nav>


<div class="sidebar-item">
  <p>
<a href="/about">About</a> | 
<a href="https://github.com/jamesclancy" aria-label="github" target="_blank" rel="noopener"> 
  <i class="fab fa-github-alt"></i> Github </a> | 
<a href="/feed.xml" aria-label="rss"> <i class="fas fa-rss"></i> RSS </a>
    </p>
    <p>
      &copy; 2022. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">James Clancy</a>
            <small>This needs to be reorganized in the future.</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/projects/wilkensavenue/2021/09/07/WilkensAvenueStep19UpdateLoginInfoInNavbar/">
        Wilkens Avenue - Step 19 - Update Login Information in Navbar
      </a>
    </h1>

    <span class="post-date">07 Sep 2021</span>

    <h2 id="goals-of-this-step">Goals of this Step</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* Navbar reflects if the user is logged in
* If the user is not logged in they are offered the option to login or register
* If the user is logged in they are offered the option to logout
</code></pre></div></div>

<h2 id="process">Process</h2>

<p>In order to check if a user is logged in I am adding a new <code class="language-plaintext highlighter-rouge">IPublicAccountApi</code> which is going to return the current logged in user and <code class="language-plaintext highlighter-rouge">ISecureAccountApi</code> which prompts the user to login.</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">IPublicAccountApi</span> <span class="p">=</span>
    <span class="p">{</span>
        <span class="n">getCurrentUser</span><span class="p">:</span> <span class="kt">unit</span> <span class="p">-&gt;</span> <span class="nc">Async</span><span class="p">&lt;</span><span class="nc">Option</span><span class="p">&lt;</span><span class="kt">string</span><span class="o">&gt;&gt;</span>
    <span class="p">}</span>

<span class="k">type</span> <span class="nc">ISecureAccountApi</span> <span class="p">=</span>
    <span class="p">{</span>
        <span class="n">login</span><span class="p">:</span> <span class="kt">unit</span> <span class="p">-&gt;</span>  <span class="nc">Async</span><span class="p">&lt;</span><span class="nc">Option</span><span class="p">&lt;</span><span class="kt">string</span><span class="o">&gt;&gt;</span>
    <span class="p">}</span></code></pre></figure>

<p>I added function to <code class="language-plaintext highlighter-rouge">Authentication</code> to pull the user information from the <code class="language-plaintext highlighter-rouge">HttpContext</code></p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">userInformationFromContext</span> <span class="p">(</span><span class="n">ctx</span> <span class="p">:</span><span class="nc">HttpContext</span><span class="p">)</span> <span class="p">=</span>
    <span class="k">let</span> <span class="n">nameClaim</span> <span class="p">=</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span> <span class="p">(</span><span class="k">fun</span> <span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Security</span><span class="p">.</span><span class="nn">Claims</span><span class="p">.</span><span class="nc">Claim</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">x</span><span class="p">.</span><span class="nc">Type</span> <span class="p">=</span> <span class="s2">"playerName"</span><span class="p">)</span> <span class="n">ctx</span><span class="p">.</span><span class="nn">User</span><span class="p">.</span><span class="nc">Claims</span> <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">toList</span>
    <span class="k">let</span> <span class="n">idClaim</span> <span class="p">=</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span> <span class="p">(</span><span class="k">fun</span> <span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Security</span><span class="p">.</span><span class="nn">Claims</span><span class="p">.</span><span class="nc">Claim</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">x</span><span class="p">.</span><span class="nc">Type</span> <span class="p">=</span> <span class="s2">"playerId"</span><span class="p">)</span> <span class="n">ctx</span><span class="p">.</span><span class="nn">User</span><span class="p">.</span><span class="nc">Claims</span> <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">toList</span>

    <span class="k">match</span> <span class="n">nameClaim</span><span class="p">,</span> <span class="n">idClaim</span> <span class="k">with</span>
    <span class="p">|</span> <span class="p">[</span> <span class="n">x</span> <span class="o">],</span> <span class="p">[</span> <span class="n">y</span> <span class="p">]</span> <span class="p">-&gt;</span> <span class="nc">Some</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nc">Value</span><span class="p">,</span> <span class="n">y</span><span class="p">.</span><span class="nc">Value</span><span class="p">)</span>
    <span class="p">|</span> <span class="bp">[]</span> <span class="p">,</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="p">-&gt;</span> <span class="nc">Some</span> <span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="nc">Value</span><span class="p">,</span> <span class="n">y</span><span class="p">.</span><span class="nc">Value</span><span class="p">)</span>
    <span class="p">|</span> <span class="o">_,_</span> <span class="p">-&gt;</span> <span class="nc">None</span>

<span class="k">let</span> <span class="n">userDisplayNameFromContext</span> <span class="p">(</span><span class="n">ctx</span> <span class="p">:</span> <span class="nc">HttpContext</span><span class="p">)</span> <span class="p">=</span>
    <span class="k">match</span> <span class="n">userInformationFromContext</span> <span class="n">ctx</span> <span class="k">with</span>
    <span class="p">|</span> <span class="nc">None</span> <span class="p">-&gt;</span>  <span class="nc">None</span>
    <span class="p">|</span> <span class="nc">Some</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">Some</span> <span class="n">x</span></code></pre></figure>

<p>I could then implement the server like:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">generalPurposeApi</span> <span class="n">ctx</span> <span class="p">=</span>
        <span class="p">{</span>
            <span class="n">getCurrentUser</span> <span class="p">=</span> <span class="k">fun</span> <span class="kt">unit</span> <span class="p">-&gt;</span> <span class="n">async</span> <span class="p">{</span> <span class="k">return</span> <span class="n">userDisplayNameFromContext</span> <span class="n">ctx</span> <span class="p">}</span>
        <span class="p">}</span>

<span class="k">let</span> <span class="n">accountInformationApi</span> <span class="n">ctx</span> <span class="p">=</span>
        <span class="p">{</span>
            <span class="n">login</span> <span class="p">=</span> <span class="k">fun</span> <span class="kt">unit</span> <span class="p">-&gt;</span> <span class="n">async</span> <span class="p">{</span> <span class="k">return</span> <span class="n">userDisplayNameFromContext</span> <span class="n">ctx</span> <span class="p">}</span>
        <span class="p">}</span>

<span class="k">let</span> <span class="n">buildLocationApi</span> <span class="n">next</span> <span class="n">ctx</span> <span class="p">=</span>
    <span class="n">task</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">handler</span> <span class="p">=</span>
            <span class="nn">Remoting</span><span class="p">.</span><span class="n">createApi</span> <span class="bp">()</span>
            <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">withRouteBuilder</span> <span class="nn">Route</span><span class="p">.</span><span class="n">builderWithoutApiPrefix</span>
            <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">fromValue</span> <span class="n">locationInformationApi</span>
            <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">buildHttpHandler</span>
        <span class="k">return</span><span class="o">!</span> <span class="n">handler</span> <span class="n">next</span> <span class="n">ctx</span>
    <span class="p">}</span>

<span class="k">let</span> <span class="n">buildSecureAccountApi</span> <span class="n">next</span> <span class="n">ctx</span> <span class="p">=</span>
        <span class="n">task</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">handler</span> <span class="p">=</span>
                <span class="nn">Remoting</span><span class="p">.</span><span class="n">createApi</span> <span class="bp">()</span>
                <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">withRouteBuilder</span> <span class="nn">Route</span><span class="p">.</span><span class="n">builderWithoutApiPrefix</span>
                <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">fromValue</span> <span class="n">accountInformationApi</span>
                <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">buildHttpHandler</span>
            <span class="k">return</span><span class="o">!</span> <span class="n">handler</span> <span class="n">next</span> <span class="n">ctx</span>
        <span class="p">}</span>
        
<span class="k">let</span> <span class="n">buildPublicAccountApi</span> <span class="n">next</span> <span class="n">ctx</span> <span class="p">=</span>
                <span class="n">task</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="n">handler</span> <span class="p">=</span>
                        <span class="nn">Remoting</span><span class="p">.</span><span class="n">createApi</span> <span class="bp">()</span>
                        <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">withRouteBuilder</span> <span class="nn">Route</span><span class="p">.</span><span class="n">builderWithoutApiPrefix</span>
                        <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">fromValue</span> <span class="n">generalPurposeApi</span>
                        <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">buildHttpHandler</span>
                    <span class="k">return</span><span class="o">!</span> <span class="n">handler</span> <span class="n">next</span> <span class="n">ctx</span>
                <span class="p">}</span>

<span class="k">let</span> <span class="n">routes</span> <span class="p">:</span> <span class="nc">HttpFunc</span> <span class="p">-&gt;</span> <span class="nc">HttpContext</span> <span class="p">-&gt;</span> <span class="nc">HttpFuncResult</span> <span class="p">=</span>
    <span class="n">choose</span> <span class="p">[</span> <span class="n">route</span> <span class="s2">"/loggedinhomepage"</span>
             <span class="o">&gt;=&gt;</span> <span class="p">(</span><span class="n">authChallenge</span>
                  <span class="o">&gt;=&gt;</span> <span class="n">htmlString</span> <span class="s2">"You are logged in now."</span><span class="p">)</span>
             <span class="n">subRoute</span> <span class="s2">"/api"</span> <span class="p">(</span> <span class="n">buildLocationApi</span><span class="p">)</span>
             <span class="n">subRoute</span> <span class="s2">"/api"</span> <span class="p">(</span> <span class="n">buildPublicAccountApi</span><span class="p">)</span>
             <span class="n">subRoute</span> <span class="s2">"/api"</span> <span class="p">(</span> <span class="n">authChallenge</span> <span class="o">&gt;=&gt;</span> <span class="n">buildSecureAccountApi</span><span class="o">)]</span></code></pre></figure>

<p>In order to implement this on the client I registered instances of the IPublicAccountApi and ISecureAccountApi</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">secureAccountApi</span> <span class="p">=</span>
    <span class="nn">Remoting</span><span class="p">.</span><span class="n">createApi</span> <span class="bp">()</span>
    <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">withRouteBuilder</span> <span class="nn">Route</span><span class="p">.</span><span class="n">builder</span>
    <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">buildProxy</span><span class="p">&lt;</span><span class="nc">ISecureAccountApi</span><span class="p">&gt;</span>
<span class="k">let</span> <span class="n">publicAccountApi</span> <span class="p">=</span>
    <span class="nn">Remoting</span><span class="p">.</span><span class="n">createApi</span> <span class="bp">()</span>
    <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">withRouteBuilder</span> <span class="nn">Route</span><span class="p">.</span><span class="n">builder</span>
    <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">buildProxy</span><span class="p">&lt;</span><span class="nc">IPublicAccountApi</span><span class="p">&gt;</span></code></pre></figure>

<p>I know need to add a subscription in the elmish app to get current logged in user.</p>

<p>To accomplish this I first added two subtypes to the <code class="language-plaintext highlighter-rouge">Msg</code></p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">Msg</span> <span class="p">=</span>
    <span class="p">|</span> <span class="nc">ToggleBurger</span>
    <span class="p">|</span> <span class="nc">UserInformationRequired</span>
    <span class="p">|</span> <span class="nc">UserInformationFetched</span> <span class="k">of</span> <span class="kt">string</span> <span class="n">option</span>
    <span class="p">|</span> <span class="nc">ReceivedLocationDetail</span> <span class="k">of</span> <span class="nc">LocationDetailModel</span>
    <span class="p">|</span> <span class="nc">BrowsePageFilterChanged</span> <span class="k">of</span> <span class="nc">BrowsePageFilterChange</span>
    <span class="p">|</span> <span class="nc">ReceivedBrowsePageResult</span> <span class="k">of</span> <span class="nc">BrowsePageModel</span>
    <span class="p">|</span> <span class="nc">LocationDetailUpdated</span> <span class="k">of</span> <span class="nc">LocationDetailUpdate</span>
    <span class="p">|</span> <span class="nc">LocationDetailUpdateServerResponseReceived</span> <span class="k">of</span> <span class="nc">LocationDetailModel</span> <span class="p">*</span> <span class="nc">UpdateLocationDetailState</span></code></pre></figure>

<p>Then I added the logic to respond to the messages.</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">update</span> <span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="nc">Msg</span><span class="p">)</span> <span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nc">Model</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Model</span> <span class="p">*</span> <span class="nc">Cmd</span><span class="p">&lt;</span><span class="nc">Msg</span><span class="p">&gt;</span> <span class="p">=</span>
    <span class="k">match</span> <span class="n">msg</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="nc">PageModel</span> <span class="k">with</span>
    <span class="p">|</span> <span class="nc">ToggleBurger</span><span class="p">,</span> <span class="p">_</span> <span class="p">-&gt;</span>
        <span class="p">{</span> <span class="n">model</span> <span class="k">with</span>
              <span class="nc">MenuBurgerExpanded</span> <span class="p">=</span> <span class="k">not</span> <span class="n">model</span><span class="p">.</span><span class="nc">MenuBurgerExpanded</span> <span class="o">},</span>
        <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="nc">UserInformationRequired</span> <span class="o">,_</span> <span class="p">-&gt;</span>
        <span class="n">model</span><span class="p">,</span> <span class="nn">Cmd</span><span class="p">.</span><span class="nn">OfAsync</span><span class="p">.</span><span class="n">perform</span> <span class="n">publicAccountApi</span><span class="p">.</span><span class="n">getCurrentUser</span> <span class="bp">()</span> <span class="nc">UserInformationFetched</span>
    <span class="p">|</span> <span class="nc">UserInformationFetched</span> <span class="n">u</span><span class="p">,</span> <span class="p">_</span> <span class="p">-&gt;</span>
        <span class="p">{</span> <span class="n">model</span> <span class="k">with</span>
              <span class="nc">CurrentUser</span> <span class="p">=</span> <span class="n">u</span> <span class="o">},</span>
        <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="nc">ReceivedLocationDetail</span> <span class="n">d</span><span class="p">,</span> <span class="p">_</span> <span class="p">-&gt;</span>
        <span class="n">modelWithNewPageModel</span>
        <span class="o">...</span></code></pre></figure>

<p>I then registered a timer like:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">userInformationUpdateRequired</span> <span class="n">initial</span> <span class="p">=</span>
    <span class="k">let</span> <span class="n">sub</span> <span class="n">dispatch</span><span class="p">=</span>
        <span class="n">window</span><span class="p">.</span><span class="n">setInterval</span><span class="o">((</span><span class="k">fun</span> <span class="p">_</span> <span class="p">-&gt;</span>
            <span class="n">dispatch</span> <span class="p">(</span><span class="nc">UserInformationRequired</span><span class="o">)),</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
    <span class="nn">Cmd</span><span class="p">.</span><span class="n">ofSub</span> <span class="n">sub</span>

<span class="nn">Program</span><span class="p">.</span><span class="n">mkProgram</span> <span class="nn">Index</span><span class="p">.</span><span class="n">init</span> <span class="nn">Index</span><span class="p">.</span><span class="n">update</span> <span class="nn">Index</span><span class="p">.</span><span class="n">view</span>
<span class="p">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">withSubscription</span> <span class="n">userInformationUpdateRequired</span>
<span class="p">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">toNavigable</span> <span class="p">(</span><span class="n">parseHash</span> <span class="n">clientRouter</span><span class="p">)</span> <span class="n">urlUpdate</span>
<span class="p">#</span><span class="k">if</span> <span class="nc">DEBUG</span>
<span class="p">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">withConsoleTrace</span>
<span class="p">#</span><span class="n">endif</span>
<span class="p">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">withReactSynchronous</span> <span class="s2">"elmish-app"</span>
<span class="p">#</span><span class="k">if</span> <span class="nc">DEBUG</span>
<span class="p">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">withDebugger</span>
<span class="p">#</span><span class="n">endif</span>
<span class="p">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">run</span></code></pre></figure>

<p>Note this had to go above the Program.toNavigable. If the subscription is added after hte <code class="language-plaintext highlighter-rouge">toNavigatable</code> the type passed to the dispatch is incorrect.</p>

<p>This now loads and runs but the Api requests fail with: <code class="language-plaintext highlighter-rouge">"Protocol definition must be encoded as a record type. The input type 'FSharpFunc</code><code class="language-plaintext highlighter-rouge">2'</code> was not a record.”<code class="language-plaintext highlighter-rouge"> This is because the Api need to return a fully defined type and not an </code>option string`.</p>

<p>The shared <code class="language-plaintext highlighter-rouge">DataTransferFormats</code> I added <code class="language-plaintext highlighter-rouge">CurrentUserLoginStatusResponse</code>:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">CurrentUserLoginStatusResponse</span> <span class="p">=</span>
    <span class="p">{</span>
        <span class="nc">CurrentlyLoggedIn</span><span class="p">:</span> <span class="kt">bool</span>
        <span class="nc">CurrentUserId</span><span class="p">:</span> <span class="kt">string</span> <span class="n">option</span>
        <span class="nc">CurrentUserName</span><span class="p">:</span> <span class="kt">string</span> <span class="n">option</span>
    <span class="p">}</span></code></pre></figure>

<p>In authorization I updated the function to pull information from the context:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">userInformationFromContext</span> <span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="nc">HttpContext</span><span class="p">)</span> <span class="p">=</span>
    <span class="k">let</span> <span class="n">nameClaim</span> <span class="p">=</span>
        <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span> <span class="p">(</span><span class="k">fun</span> <span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Security</span><span class="p">.</span><span class="nn">Claims</span><span class="p">.</span><span class="nc">Claim</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">x</span><span class="p">.</span><span class="nc">Type</span> <span class="p">=</span> <span class="s2">"playerName"</span><span class="p">)</span> <span class="n">ctx</span><span class="p">.</span><span class="nn">User</span><span class="p">.</span><span class="nc">Claims</span>
        <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">toList</span>

    <span class="k">let</span> <span class="n">idClaim</span> <span class="p">=</span>
        <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span> <span class="p">(</span><span class="k">fun</span> <span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Security</span><span class="p">.</span><span class="nn">Claims</span><span class="p">.</span><span class="nc">Claim</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">x</span><span class="p">.</span><span class="nc">Type</span> <span class="p">=</span> <span class="s2">"playerId"</span><span class="p">)</span> <span class="n">ctx</span><span class="p">.</span><span class="nn">User</span><span class="p">.</span><span class="nc">Claims</span>
        <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">toList</span>

    <span class="k">match</span> <span class="n">nameClaim</span><span class="p">,</span> <span class="n">idClaim</span> <span class="k">with</span>
    <span class="p">|</span> <span class="p">[</span> <span class="n">x</span> <span class="o">],</span> <span class="p">[</span> <span class="n">y</span> <span class="p">]</span> <span class="p">-&gt;</span>
        <span class="p">{</span> <span class="nc">CurrentlyLoggedIn</span> <span class="p">=</span> <span class="bp">true</span>
          <span class="nc">CurrentUserId</span> <span class="p">=</span> <span class="nc">Some</span> <span class="n">y</span><span class="p">.</span><span class="nc">Value</span>
          <span class="nc">CurrentUserName</span> <span class="p">=</span> <span class="nc">Some</span> <span class="n">x</span><span class="p">.</span><span class="nc">Value</span> <span class="p">}</span>
    <span class="p">|</span> <span class="bp">[]</span><span class="p">,</span> <span class="p">[</span> <span class="n">y</span> <span class="p">]</span> <span class="p">-&gt;</span>
        <span class="p">{</span> <span class="nc">CurrentlyLoggedIn</span> <span class="p">=</span> <span class="bp">true</span>
          <span class="nc">CurrentUserId</span> <span class="p">=</span> <span class="nc">Some</span> <span class="n">y</span><span class="p">.</span><span class="nc">Value</span>
          <span class="nc">CurrentUserName</span> <span class="p">=</span> <span class="nc">Some</span> <span class="n">y</span><span class="p">.</span><span class="nc">Value</span> <span class="p">}</span>
    <span class="p">|</span> <span class="o">_,</span> <span class="p">_</span> <span class="p">-&gt;</span>
        <span class="p">{</span> <span class="nc">CurrentlyLoggedIn</span> <span class="p">=</span> <span class="bp">false</span>
          <span class="nc">CurrentUserId</span> <span class="p">=</span> <span class="nc">None</span>
          <span class="nc">CurrentUserName</span> <span class="p">=</span> <span class="nc">None</span> <span class="p">}</span></code></pre></figure>

<p>I updated the apis to return this type.</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">IPublicAccountApi</span> <span class="p">=</span>
    <span class="p">{</span> <span class="n">getCurrentUser</span><span class="p">:</span> <span class="kt">unit</span> <span class="p">-&gt;</span> <span class="nc">Async</span><span class="p">&lt;</span><span class="nc">CurrentUserLoginStatusResponse</span><span class="p">&gt;</span> <span class="p">}</span>

<span class="k">type</span> <span class="nc">ISecureAccountApi</span> <span class="p">=</span>
    <span class="p">{</span> <span class="n">login</span><span class="p">:</span> <span class="kt">unit</span> <span class="p">-&gt;</span> <span class="nc">Async</span><span class="p">&lt;</span><span class="nc">CurrentUserLoginStatusResponse</span><span class="p">&gt;</span> <span class="p">}</span></code></pre></figure>

<p>And implemented it with:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">generalPurposeApi</span> <span class="n">ctx</span> <span class="p">=</span>
    <span class="p">{</span> <span class="n">getCurrentUser</span> <span class="p">=</span> <span class="k">fun</span> <span class="kt">unit</span> <span class="p">-&gt;</span> <span class="n">async</span> <span class="p">{</span> <span class="k">return</span> <span class="n">userInformationFromContext</span> <span class="n">ctx</span> <span class="p">}</span> <span class="p">}</span>

<span class="k">let</span> <span class="n">accountInformationApi</span> <span class="n">ctx</span> <span class="p">=</span>
    <span class="p">{</span> <span class="n">login</span> <span class="p">=</span> <span class="k">fun</span> <span class="kt">unit</span> <span class="p">-&gt;</span> <span class="n">async</span> <span class="p">{</span> <span class="k">return</span> <span class="n">userInformationFromContext</span> <span class="n">ctx</span> <span class="p">}</span> <span class="p">}</span></code></pre></figure>

<p>This now loads and runs but the Api requests fails with the same error: <code class="language-plaintext highlighter-rouge">"Protocol definition must be encoded as a record type. The input type 'FSharpFunc</code><code class="language-plaintext highlighter-rouge">2'</code> was not a record.”`</p>

<p>It turns out I was mistaken about hte reason for the error. I just had a typo in my buildApi methods. I needed to change them to:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="n">s</span>
<span class="k">let</span> <span class="n">buildSecureAccountApi</span> <span class="n">next</span> <span class="n">ctx</span> <span class="p">=</span>
    <span class="n">task</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">handler</span> <span class="p">=</span>
            <span class="nn">Remoting</span><span class="p">.</span><span class="n">createApi</span> <span class="bp">()</span>
            <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">withRouteBuilder</span> <span class="nn">Route</span><span class="p">.</span><span class="n">builderWithoutApiPrefix</span>
            <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">fromValue</span> <span class="p">(</span><span class="n">accountInformationApi</span> <span class="n">ctx</span><span class="p">)</span>
            <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">buildHttpHandler</span>

        <span class="k">return</span><span class="o">!</span> <span class="n">handler</span> <span class="n">next</span> <span class="n">ctx</span>
    <span class="p">}</span>

<span class="k">let</span> <span class="n">buildPublicAccountApi</span> <span class="n">next</span> <span class="n">ctx</span> <span class="p">=</span>
    <span class="n">task</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">handler</span> <span class="p">=</span>
            <span class="nn">Remoting</span><span class="p">.</span><span class="n">createApi</span> <span class="bp">()</span>
            <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">withRouteBuilder</span> <span class="nn">Route</span><span class="p">.</span><span class="n">builderWithoutApiPrefix</span>
            <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">fromValue</span> <span class="p">(</span><span class="n">accountPublishApi</span> <span class="n">ctx</span><span class="p">)</span>
            <span class="p">|&gt;</span> <span class="nn">Remoting</span><span class="p">.</span><span class="n">buildHttpHandler</span>

        <span class="k">return</span><span class="o">!</span> <span class="n">handler</span> <span class="n">next</span> <span class="n">ctx</span>
    <span class="p">}</span></code></pre></figure>

<p>Now it is running correctly.</p>

<p>I then had to add the logic to actually login and logout of the site as normal paths on the server</p>

<p>In the <code class="language-plaintext highlighter-rouge">Server</code> I updated:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">routes</span> <span class="p">:</span> <span class="nc">HttpFunc</span> <span class="p">-&gt;</span> <span class="nc">HttpContext</span> <span class="p">-&gt;</span> <span class="nc">HttpFuncResult</span> <span class="p">=</span>
    <span class="n">choose</span> <span class="p">[</span> <span class="n">route</span> <span class="s2">"/login"</span>  <span class="o">&gt;=&gt;</span> <span class="p">(</span><span class="n">authChallenge</span> <span class="o">&gt;=&gt;</span> <span class="n">redirectTo</span> <span class="bp">false</span> <span class="s2">"/"</span><span class="p">)</span>
             <span class="n">route</span> <span class="s2">"/signout"</span> <span class="o">&gt;=&gt;</span> <span class="n">signOut</span> <span class="o">&gt;=&gt;</span>   <span class="n">htmlString</span> <span class="s2">"Logged Out."</span>
             <span class="n">subRoute</span> <span class="s2">"/api"</span> <span class="p">(</span><span class="n">buildLocationApi</span><span class="p">)</span>
             <span class="o">...</span></code></pre></figure>

<p>Under authentication I added</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">signOut</span> <span class="p">(</span><span class="n">next</span> <span class="p">:</span> <span class="nc">HttpFunc</span><span class="p">)</span> <span class="p">(</span><span class="n">ctx</span> <span class="p">:</span> <span class="nc">HttpContext</span><span class="p">)</span> <span class="p">=</span>
  <span class="n">task</span> <span class="p">{</span>
    <span class="k">do</span><span class="o">!</span> <span class="n">ctx</span><span class="p">.</span><span class="nc">SignOutAsync</span><span class="bp">()</span>
    <span class="k">return</span><span class="o">!</span> <span class="n">next</span> <span class="n">ctx</span>
  <span class="p">}</span></code></pre></figure>

<p>I then added the <code class="language-plaintext highlighter-rouge">login</code>, <code class="language-plaintext highlighter-rouge">logout</code> and <code class="language-plaintext highlighter-rouge">signin-oidc</code> paths to the webpack proxy for the dev server.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var CONFIG = {
    // The tags to include the generated JS and CSS will be automatically injected in the HTML template
    // See https://github.com/jantimon/html-webpack-plugin
    indexHtmlTemplate: './src/Client/index.html',
    fsharpEntry: './src/Client/App.fs.js',
    outputDir: './deploy/public',
    assetsDir: './src/Client/public',
    devServerPort: 8080,
    // When using webpack-dev-server, you may need to redirect some calls
    // to a external API server. See https://webpack.js.org/configuration/dev-server/#devserver-proxy
    devServerProxy: {
        // redirect requests that start with /api/ to the server on port 8085
        '/api/**': {
            target: 'http://localhost:' + (process.env.SERVER_PROXY_PORT || "8085"),
            changeOrigin: true
        },
        // redirect websocket requests that start with /socket/ to the server on the port 8085
        '/socket/**': {
            target: 'http://localhost:' + (process.env.SERVER_PROXY_PORT || "8085"),
            ws: true
        },
        // redirect websocket requests that start with /socket/ to the server on the port 8085
        '/login**': {
            target: 'http://localhost:' + (process.env.SERVER_PROXY_PORT || "8085"),
            changeOrigin: true
        },
        // redirect websocket requests that start with /socket/ to the server on the port 8085
        '/logout**': {
            target: 'http://localhost:' + (process.env.SERVER_PROXY_PORT || "8085"),
            changeOrigin: true
        },
        // redirect websocket requests that start with /socket/ to the server on the port 8085
        '/signin-oidc**': {
            target: 'http://localhost:' + (process.env.SERVER_PROXY_PORT || "8085"),
            changeOrigin: true
        }
    }
}
</code></pre></div></div>

<p>I then added the html to render the login/register or logout.</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp">    <span class="k">let</span> <span class="n">navBarLoginContent</span> <span class="p">=</span>
        <span class="k">match</span> <span class="n">model</span><span class="p">.</span><span class="nc">CurrentUser</span> <span class="k">with</span>
        <span class="p">|</span> <span class="nc">None</span> <span class="p">-&gt;</span>
            <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbarItem</span><span class="p">.</span><span class="n">div</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">buttons</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">button</span><span class="p">.</span><span class="n">a</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="s2">"Login or Register"</span><span class="p">;</span> <span class="n">prop</span><span class="p">.</span><span class="n">href</span> <span class="s2">"/login"</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>
        <span class="p">|</span> <span class="nc">Some</span> <span class="n">s</span> <span class="p">-&gt;</span>  <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbarItem</span><span class="p">.</span><span class="n">div</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">buttons</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">button</span><span class="p">.</span><span class="n">a</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="s2">"Logout"</span><span class="p">;</span> <span class="n">prop</span><span class="p">.</span><span class="n">href</span> <span class="s2">"/logout"</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span></code></pre></figure>

<p>I am now brought to Okta to login but when it completes the redirect page is broken.</p>

<p>` The cookie ‘.AspNetCore.OpenIdConnect.Nonce… has set ‘SameSite=None’ and must also set ‘Secure’.`</p>

<p>I was able to update the cookie settings like so</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nn">Saturn</span><span class="p">.</span><span class="nn">Application</span><span class="p">.</span><span class="nc">ApplicationBuilder</span> <span class="k">with</span>
    <span class="p">[&lt;</span><span class="nc">CustomOperation</span><span class="p">(</span><span class="s2">"use_open_id_auth_with_config_from_service_collection"</span><span class="o">)&gt;]</span>
    <span class="k">member</span> <span class="o">__.</span><span class="nc">UseOpenIdAuthWithConfigFromServiceCollection</span>
        <span class="p">(</span>
            <span class="n">state</span><span class="p">:</span> <span class="nc">ApplicationState</span><span class="p">,</span>
            <span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="nc">IServiceCollection</span> <span class="p">-&gt;</span> <span class="nc">Action</span><span class="p">&lt;</span><span class="nn">OpenIdConnect</span><span class="p">.</span><span class="nc">OpenIdConnectOptions</span><span class="o">&gt;)</span>
        <span class="p">)</span> <span class="p">=</span>
        <span class="k">let</span> <span class="n">middleware</span> <span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="nc">IApplicationBuilder</span><span class="p">)</span> <span class="p">=</span> <span class="n">app</span><span class="p">.</span><span class="nc">UseAuthentication</span><span class="bp">()</span>

        <span class="k">let</span> <span class="n">service</span> <span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nc">IServiceCollection</span><span class="p">)</span> <span class="p">=</span>
            <span class="k">let</span> <span class="n">authBuilder</span> <span class="p">=</span>
                <span class="n">s</span><span class="p">.</span><span class="nc">AddAuthentication</span>
                    <span class="p">(</span><span class="k">fun</span> <span class="n">authConfig</span> <span class="p">-&gt;</span>
                        <span class="n">authConfig</span><span class="p">.</span><span class="nc">DefaultScheme</span> <span class="p">&lt;-</span> <span class="nn">CookieAuthenticationDefaults</span><span class="p">.</span><span class="nc">AuthenticationScheme</span>
                        <span class="n">authConfig</span><span class="p">.</span><span class="nc">DefaultChallengeScheme</span> <span class="p">&lt;-</span> <span class="nn">OpenIdConnectDefaults</span><span class="p">.</span><span class="nc">AuthenticationScheme</span>
                        <span class="n">authConfig</span><span class="p">.</span><span class="nc">DefaultSignInScheme</span> <span class="p">&lt;-</span> <span class="nn">CookieAuthenticationDefaults</span><span class="p">.</span><span class="nc">AuthenticationScheme</span>
                        <span class="p">)</span>

            <span class="k">if</span> <span class="k">not</span> <span class="n">state</span><span class="p">.</span><span class="nc">CookiesAlreadyAdded</span> <span class="k">then</span>
                <span class="n">authBuilder</span><span class="p">.</span><span class="nc">AddCookie</span><span class="o">((</span><span class="k">fun</span> <span class="n">opt</span> <span class="p">-&gt;</span>
                                                  <span class="n">opt</span><span class="p">.</span><span class="nn">Cookie</span><span class="p">.</span><span class="nc">SameSite</span> <span class="p">&lt;-</span> <span class="nn">SameSiteMode</span><span class="p">.</span><span class="nc">Lax</span>
                                                  <span class="n">opt</span><span class="p">.</span><span class="nn">Cookie</span><span class="p">.</span><span class="nc">SecurePolicy</span> <span class="p">&lt;-</span> <span class="nn">CookieSecurePolicy</span><span class="p">.</span><span class="nc">None</span>
                                                  <span class="n">opt</span><span class="p">.</span><span class="nn">Cookie</span><span class="p">.</span><span class="nc">IsEssential</span> <span class="p">&lt;-</span> <span class="bp">true</span> <span class="o">))</span> <span class="p">|&gt;</span> <span class="n">ignore</span>

            <span class="n">authBuilder</span><span class="p">.</span><span class="nc">AddOpenIdConnect</span><span class="p">(</span><span class="nn">OpenIdConnectDefaults</span><span class="p">.</span><span class="nc">AuthenticationScheme</span><span class="p">,</span> <span class="p">(</span><span class="n">config</span> <span class="n">s</span><span class="o">))</span>
            <span class="p">|&gt;</span> <span class="n">ignore</span>

            <span class="n">s</span>

        <span class="p">{</span> <span class="n">state</span> <span class="k">with</span>
              <span class="nc">ServicesConfig</span> <span class="p">=</span> <span class="n">service</span> <span class="p">::</span> <span class="n">state</span><span class="p">.</span><span class="nc">ServicesConfig</span>
              <span class="nc">AppConfigs</span> <span class="p">=</span> <span class="n">middleware</span> <span class="p">::</span> <span class="n">state</span><span class="p">.</span><span class="nc">AppConfigs</span>
              <span class="nc">CookiesAlreadyAdded</span> <span class="p">=</span> <span class="bp">true</span> <span class="p">}</span></code></pre></figure>

<p>I am still getting an error ` cookie not found.`. I am thinking this is because the url/ ip generated for the redirect is at port 8085 while the client is being served by webpack at 8080. i.e. Webpack is proxying the request to the server @ 8085 which uses the cookie info from 8080 and the port from the server instance to create the request to Okta. Okta is then redirecting back to 8085 which is unable to find the cookie from the client port.</p>

<p>I tried enabling forwarded headers in asp.net:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp">        <span class="k">let</span> <span class="n">service</span> <span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nc">IServiceCollection</span><span class="p">)</span> <span class="p">=</span>
            <span class="n">s</span><span class="p">.</span><span class="nc">Configure</span><span class="p">&lt;</span><span class="nc">ForwardedHeadersOptions</span><span class="o">&gt;(</span><span class="k">fun</span> <span class="p">(</span><span class="n">options</span><span class="p">:</span><span class="nc">ForwardedHeadersOptions</span><span class="p">)</span> <span class="p">-&gt;</span>
                <span class="n">options</span><span class="p">.</span><span class="nc">ForwardedHeaders</span> <span class="p">&lt;-</span> <span class="nn">ForwardedHeaders</span><span class="p">.</span><span class="nc">All</span>
                <span class="n">options</span><span class="p">.</span><span class="nn">KnownNetworks</span><span class="p">.</span><span class="nc">Clear</span><span class="bp">()</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
                <span class="n">options</span><span class="p">.</span><span class="nn">KnownProxies</span><span class="p">.</span><span class="nc">Clear</span><span class="bp">()</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
            <span class="p">)</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
            
            <span class="k">let</span> <span class="n">authBuilder</span> <span class="p">=</span>
            <span class="o">...</span></code></pre></figure>

<p>This did not do what was needed. I am assuming I also need to configure WebPack to set forward headers.</p>

<p>After updating Webpack to forward headers it still was not working. After reading a lot of blog posts I found that that issue was</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">addAuth</span> <span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="nc">IApplicationBuilder</span><span class="p">)</span> <span class="p">=</span>
    <span class="n">app</span><span class="p">.</span><span class="nc">UseCookiePolicy</span><span class="p">(</span><span class="k">new</span> <span class="nc">CookiePolicyOptions</span><span class="p">(</span><span class="nc">MinimumSameSitePolicy</span><span class="p">=</span><span class="nn">SameSiteMode</span><span class="p">.</span><span class="nc">Lax</span><span class="p">,</span><span class="nc">Secure</span><span class="p">=</span><span class="nn">CookieSecurePolicy</span><span class="p">.</span><span class="nc">None</span><span class="o">)).</span><span class="nc">UseAuthentication</span><span class="bp">()</span></code></pre></figure>

<p>which was being called last in the ApplicationBuilder, this was wiping out the cookies. I removed the line and it started to work in firefox but not in Chrome.</p>

<h2 id="results">Results</h2>

<p><a href="https://github.com/jamesclancy/WilkensAvenue/tree/step-19">Git branch for this step</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/projects/wilkensavenue/2021/09/07/WilkensAvenueStep18FixNavbar/">
        Wilkens Avenue - Step 18 - Fix Navbar
      </a>
    </h1>

    <span class="post-date">07 Sep 2021</span>

    <h2 id="goals-of-this-step">Goals of this Step</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* Navbar burger clicked is handled via the elmish messaging
</code></pre></div></div>

<h2 id="process">Process</h2>

<p>After pushing the change for the menu burger yesterday I noticed that it was not working properly with the hacky javascript so I will have to implement the burger expander properly.</p>

<p>To do this I updated the client <code class="language-plaintext highlighter-rouge">Model</code> to include a <code class="language-plaintext highlighter-rouge">MenuBurgerExpanded</code>:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">Model</span> <span class="p">=</span>
    <span class="p">{</span> <span class="nc">CurrentRoute</span><span class="p">:</span> <span class="nc">Option</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span>
      <span class="nc">PageModel</span><span class="p">:</span> <span class="nc">PageModel</span>
      <span class="nc">CurrentUser</span><span class="p">:</span> <span class="nc">Option</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span>
      <span class="nc">MenuBurgerExpanded</span><span class="p">:</span> <span class="kt">bool</span> <span class="p">}</span></code></pre></figure>

<p>I added a default value for this new field in the initial client model:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">init</span> <span class="p">(</span><span class="n">initialRoute</span><span class="p">:</span> <span class="nc">Option</span><span class="p">&lt;</span><span class="nc">ClientRoute</span><span class="o">&gt;)</span> <span class="p">:</span> <span class="nc">Model</span> <span class="p">*</span> <span class="nc">Cmd</span><span class="p">&lt;</span><span class="nc">Msg</span><span class="p">&gt;</span> <span class="p">=</span>
    <span class="k">if</span> <span class="n">initialRoute</span> <span class="p">=</span> <span class="nc">None</span> <span class="k">then</span>
        <span class="p">{</span> <span class="nc">CurrentRoute</span> <span class="p">=</span> <span class="nc">None</span>
          <span class="nc">CurrentUser</span> <span class="p">=</span> <span class="nc">None</span>
          <span class="nc">PageModel</span> <span class="p">=</span> <span class="nc">HomePageModel</span>
          <span class="nc">MenuBurgerExpanded</span> <span class="p">=</span> <span class="bp">false</span><span class="o">},</span>
        <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="k">else</span>
        <span class="n">urlUpdate</span>
            <span class="n">initialRoute</span>
            <span class="p">{</span> <span class="nc">CurrentRoute</span> <span class="p">=</span> <span class="nc">None</span>
              <span class="nc">CurrentUser</span> <span class="p">=</span> <span class="nc">None</span>
              <span class="nc">PageModel</span> <span class="p">=</span> <span class="nc">LoadingScreenPageModel</span>
              <span class="nc">MenuBurgerExpanded</span> <span class="p">=</span> <span class="bp">false</span> <span class="p">}</span></code></pre></figure>

<p>I then added a BurgerToggled <code class="language-plaintext highlighter-rouge">Msg</code> type:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">Msg</span> <span class="p">=</span>
    <span class="p">|</span> <span class="nc">ToggleBurger</span>
    <span class="p">|</span> <span class="nc">ReceivedLocationDetail</span> <span class="k">of</span> <span class="nc">LocationDetailModel</span>
    <span class="p">|</span> <span class="nc">BrowsePageFilterChanged</span> <span class="k">of</span> <span class="nc">BrowsePageFilterChange</span>
    <span class="p">|</span> <span class="nc">ReceivedBrowsePageResult</span> <span class="k">of</span> <span class="nc">BrowsePageModel</span>
    <span class="p">|</span> <span class="nc">LocationDetailUpdated</span> <span class="k">of</span> <span class="nc">LocationDetailUpdate</span>
    <span class="p">|</span> <span class="nc">LocationDetailUpdateServerResponseReceived</span> <span class="k">of</span> <span class="nc">LocationDetailModel</span> <span class="p">*</span> <span class="nc">UpdateLocationDetailState</span></code></pre></figure>

<p>I then implemented the update method to handle this event:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">update</span> <span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="nc">Msg</span><span class="p">)</span> <span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nc">Model</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Model</span> <span class="p">*</span> <span class="nc">Cmd</span><span class="p">&lt;</span><span class="nc">Msg</span><span class="p">&gt;</span> <span class="p">=</span>
    <span class="k">match</span> <span class="n">msg</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="nc">PageModel</span> <span class="k">with</span>
    <span class="p">|</span> <span class="nc">ToggleBurger</span><span class="p">,</span> <span class="p">_</span> <span class="p">-&gt;</span>
        <span class="p">{</span> <span class="n">model</span> <span class="k">with</span> <span class="nc">MenuBurgerExpanded</span> <span class="p">=</span> <span class="k">not</span> <span class="n">model</span><span class="p">.</span><span class="nc">MenuBurgerExpanded</span><span class="o">},</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="nc">ReceivedLocationDetail</span> <span class="n">d</span><span class="p">,</span> <span class="p">_</span> <span class="p">-&gt;</span>
        <span class="n">modelWithNewPageModel</span>
        <span class="o">...</span></code></pre></figure>

<p>I set up the navbar to actually publish these events:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">navBar</span> <span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nc">Model</span><span class="p">)</span> <span class="p">(</span><span class="n">dispatch</span><span class="p">:</span> <span class="nc">Msg</span> <span class="p">-&gt;</span> <span class="kt">unit</span><span class="p">)</span> <span class="p">=</span>

    <span class="k">let</span> <span class="n">burgerActiveClass</span> <span class="p">=</span>
        <span class="n">seq</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">model</span><span class="p">.</span><span class="nc">MenuBurgerExpanded</span> <span class="k">then</span>
                <span class="s2">"is-active"</span>
            <span class="k">else</span>
                <span class="s2">""</span>
        <span class="p">}</span>

    <span class="nn">Html</span><span class="p">.</span><span class="n">div</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbar</span> <span class="p">[</span> <span class="n">color</span><span class="p">.</span><span class="n">isLight</span>
                                              <span class="n">navbar</span><span class="p">.</span><span class="n">isTransparent</span>
                                              <span class="n">navbar</span><span class="p">.</span><span class="n">hasShadow</span>
                                              <span class="n">navbar</span><span class="p">.</span><span class="n">isTransparent</span>
                                              <span class="n">prop</span><span class="p">.</span><span class="n">style</span> <span class="bp">[]</span>

                                              <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbarBrand</span><span class="p">.</span><span class="n">div</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbarItem</span><span class="p">.</span><span class="n">a</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">href</span>
                                                                                                               <span class="s2">"#/"</span>
                                                                                                           <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Html</span><span class="p">.</span><span class="n">h1</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">text</span>
                                                                                                                                         <span class="s2">"Wilkens Avenue"</span>
                                                                                                                                     <span class="n">prop</span><span class="p">.</span><span class="n">className</span>
                                                                                                                                         <span class="s2">"title navBarHeader"</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>

                                                                                      <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbarBurger</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">custom</span> <span class="p">(</span>
                                                                                                               <span class="s2">"data-target"</span><span class="p">,</span>
                                                                                                               <span class="s2">"nav-menu"</span>
                                                                                                           <span class="p">)</span>
                                                                                                           <span class="n">prop</span><span class="p">.</span><span class="n">classes</span>
                                                                                                               <span class="n">burgerActiveClass</span>
                                                                                                           <span class="n">prop</span><span class="p">.</span><span class="n">onClick</span>
                                                                                                               <span class="p">(</span><span class="k">fun</span> <span class="p">_</span> <span class="p">-&gt;</span>
                                                                                                                   <span class="nc">ToggleBurger</span>
                                                                                                                   <span class="p">|&gt;</span> <span class="n">dispatch</span><span class="p">)</span>
                                                                                                           <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="p">[</span>  <span class="p">]</span>
                                                                                                                           <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="p">[</span>  <span class="p">]</span>
                                                                                                                           <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="p">[</span>  <span class="p">]</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>

                                                              <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbarMenu</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">id</span> <span class="s2">"nav-menu"</span>
                                                                                 <span class="n">prop</span><span class="p">.</span><span class="n">classes</span> <span class="n">burgerActiveClass</span>
                                                                                 <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbarStart</span><span class="p">.</span><span class="n">div</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbarItem</span><span class="p">.</span><span class="n">a</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">text</span>
                                                                                 <span class="o">...</span></code></pre></figure>

<p>Finally, I updated my various function to pass along the Model so the navbar can consume it and removed the hack from the <code class="language-plaintext highlighter-rouge">index.html</code>. What may be a better future iteration would be to pass along the navbar itself instead of the model and the dispatch function.</p>

<h2 id="results">Results</h2>

<p><a href="https://github.com/jamesclancy/WilkensAvenue/tree/step-18">Git branch for this step</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/bookreviews/2021/09/07/SCRUM/">
        SCRUM The Art of Doing Twice the Work in Half the Time by Jeff Sutherland
      </a>
    </h1>

    <span class="post-date">07 Sep 2021</span>

    <h2 id="a-business-book-with-surprising-good-prose-quality---810">A business book with surprising good prose quality. - 8/10</h2>

<h2 id="summary">Summary</h2>

<p>The book details the SCRUM framework as defined by Jeff Sutherland, walks through how the different parts work and gives some examples of the usages of SCRUM outside of software development.</p>

<h2 id="my-impressions">My Impressions</h2>

<p>I was very pleasantly surprised by how well the book was written and how it actually flowed together. Generally, most business books are sort of bland and often poorly edited. This books was engaging, entertaining, informative and an easy read.</p>

<p>I really liked the context and explanation of the <a href="https://en.wikipedia.org/wiki/OODA_loop">OODA Loop</a> (Observe -&gt; Orient -&gt; Decide -&gt; Act). I thought some of the military/ historical based examples of ideas helped to drive home the points, I had to learn about WWI, WWII, Vietnam etc since I was a kid putting these ideas in the context of these conflicts resinates much better then simply talking about Toyota.</p>

<p>With all that being said I did think some of the Toyota love was a little over the top, while I am sure Toyota is one of the best run companies I feel like there have to be other companies that demonstrate similar values. Additionally, I think implying that SCRUM can fix all the worlds problems is a bit of stretch. For example, I feel like the government examples demonstrate that in order to conquer large problems you have to break them into smaller, doable parts and execute on those parts individually. While that is what you do with SCRUM that isn’t really a uniquely SCRUM idea, that is is just effective problem solving in general.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/projects/wilkensavenue/2021/09/06/WilkensAvenueStep17AddMapToLocationDetails/">
        Wilkens Avenue - Step 17 - Add Map to Location Details
      </a>
    </h1>

    <span class="post-date">06 Sep 2021</span>

    <h2 id="goals-of-this-step">Goals of this Step</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* Location details should display a map of where the historical site it located
* this location can be determined by the latitude and longitude already displayed on the page
</code></pre></div></div>

<h2 id="process">Process</h2>

<p>It looks like <a href="https://zaid-ajaj.github.io/Feliz/#/PigeonMaps/Overview">Feliz.PigeonMaps</a> would be a good &amp; easy option to add a map.</p>

<p>I added <code class="language-plaintext highlighter-rouge">"pigeon-maps": "^0.19.7"</code> to the packages.json and added <code class="language-plaintext highlighter-rouge">Feliz.PigeonMaps</code> to the general project and client <code class="language-plaintext highlighter-rouge">paket.reference</code> files.</p>

<p>I then ran <code class="language-plaintext highlighter-rouge">npm ci</code> and <code class="language-plaintext highlighter-rouge">paket install</code>.</p>

<p>Verifying, <code class="language-plaintext highlighter-rouge">dotnet run</code> still works. Based on the PigeonMaps documentation I tested adding to the <code class="language-plaintext highlighter-rouge">LocationDetails</code></p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp">    <span class="k">let</span> <span class="n">addressSection</span> <span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nc">AddressDetailModel</span> <span class="n">option</span><span class="p">)</span> <span class="p">=</span>

        <span class="k">let</span> <span class="n">tryReturnString</span> <span class="p">(</span><span class="n">optStr</span><span class="p">:</span> <span class="kt">string</span> <span class="n">option</span><span class="p">)</span> <span class="p">=</span>
            <span class="k">match</span> <span class="n">optStr</span> <span class="k">with</span>
            <span class="p">|</span> <span class="nc">None</span> <span class="p">-&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">empty</span>
            <span class="p">|</span> <span class="nc">Some</span> <span class="n">s</span> <span class="p">-&gt;</span> <span class="n">seq</span> <span class="p">{</span> <span class="k">yield</span> <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="n">s</span> <span class="p">}</span>

        <span class="k">match</span> <span class="n">address</span> <span class="k">with</span>
        <span class="p">|</span> <span class="nc">None</span> <span class="p">-&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">empty</span>
        <span class="p">|</span> <span class="nc">Some</span> <span class="n">a</span> <span class="p">-&gt;</span>
            <span class="n">seq</span> <span class="p">{</span>
                <span class="k">yield</span>
                    <span class="nn">Bulma</span><span class="p">.</span><span class="n">section</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="s2">"Location"</span>
                                    <span class="nn">Html</span><span class="p">.</span><span class="n">p</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="k">yield</span><span class="o">!</span> <span class="n">tryReturnString</span> <span class="n">a</span><span class="p">.</span><span class="nc">Address1</span>
                                                             <span class="k">yield</span><span class="o">!</span> <span class="n">tryReturnString</span> <span class="n">a</span><span class="p">.</span><span class="nc">Address2</span>
                                                             <span class="k">yield</span><span class="o">!</span> <span class="n">tryReturnString</span> <span class="n">a</span><span class="p">.</span><span class="nc">Address3</span>
                                                             <span class="k">yield</span><span class="o">!</span> <span class="n">tryReturnString</span> <span class="n">a</span><span class="p">.</span><span class="nc">City</span>
                                                             <span class="k">yield</span><span class="o">!</span> <span class="n">tryReturnString</span> <span class="n">a</span><span class="p">.</span><span class="nc">State</span>
                                                             <span class="k">yield</span><span class="o">!</span> <span class="n">tryReturnString</span> <span class="n">a</span><span class="p">.</span><span class="nc">Zipcode</span>
                                                             <span class="k">yield</span> <span class="nn">PigeonMaps</span><span class="p">.</span><span class="n">map</span> <span class="p">[</span>
                                                                 <span class="n">map</span><span class="p">.</span><span class="n">center</span><span class="p">(</span><span class="nn">System</span><span class="p">.</span><span class="nn">Decimal</span><span class="p">.</span><span class="nc">ToDouble</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="nc">Latitude</span><span class="o">),</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Decimal</span><span class="p">.</span><span class="nc">ToDouble</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="nc">Longitude</span><span class="o">))</span>
                                                                 <span class="n">map</span><span class="p">.</span><span class="n">zoom</span> <span class="mi">12</span>
                                                                 <span class="n">map</span><span class="p">.</span><span class="n">height</span> <span class="mi">350</span>
                                                                 <span class="n">map</span><span class="p">.</span><span class="n">markers</span> <span class="p">[</span>
                                                                     <span class="nn">PigeonMaps</span><span class="p">.</span><span class="n">marker</span> <span class="p">[</span>
                                                                         <span class="n">marker</span><span class="p">.</span><span class="n">anchor</span><span class="p">(</span><span class="nn">System</span><span class="p">.</span><span class="nn">Decimal</span><span class="p">.</span><span class="nc">ToDouble</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="nc">Latitude</span><span class="o">),</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Decimal</span><span class="p">.</span><span class="nc">ToDouble</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="nc">Longitude</span><span class="o">))</span>
                                                                         <span class="n">marker</span><span class="p">.</span><span class="n">offsetLeft</span> <span class="mi">15</span>
                                                                         <span class="n">marker</span><span class="p">.</span><span class="n">offsetTop</span> <span class="mi">30</span>
                                                                         <span class="n">marker</span><span class="p">.</span><span class="n">render</span> <span class="p">(</span><span class="k">fun</span> <span class="n">marker</span> <span class="p">-&gt;</span> <span class="p">[</span>
                                                                             <span class="nn">Html</span><span class="p">.</span><span class="n">i</span> <span class="p">[</span>
                                                                                 <span class="k">if</span> <span class="n">marker</span><span class="p">.</span><span class="n">hovered</span>
                                                                                 <span class="k">then</span> <span class="n">prop</span><span class="p">.</span><span class="n">style</span> <span class="p">[</span> <span class="n">style</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">red</span><span class="p">;</span> <span class="n">style</span><span class="p">.</span><span class="n">cursor</span><span class="p">.</span><span class="n">pointer</span> <span class="p">]</span>
                                                                                 <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="p">[</span> <span class="s2">"fa"</span><span class="p">;</span> <span class="s2">"fa-map-marker"</span><span class="p">;</span> <span class="s2">"fa-2x"</span> <span class="p">]</span>
                                                                             <span class="p">]</span>
                                                                         <span class="o">])</span>
                                                                     <span class="p">]</span>
                                                                 <span class="p">]</span>
                                                             <span class="p">]</span>
                                                             <span class="k">yield</span> <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="p">(</span><span class="n">sprintf</span> <span class="s2">"Latitude: %f"</span> <span class="n">a</span><span class="p">.</span><span class="nc">Latitude</span><span class="p">)</span>
                                                             <span class="k">yield</span> <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="p">(</span><span class="n">sprintf</span> <span class="s2">"Longitude: %f"</span> <span class="n">a</span><span class="p">.</span><span class="nc">Longitude</span><span class="p">)</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span></code></pre></figure>

<p>This did not work and is giving me an error <code class="language-plaintext highlighter-rouge">error FABLE: System.Decimal.ToDouble is not supported by Fable</code>. Changing the <code class="language-plaintext highlighter-rouge">System.Decimal.ToDouble</code> to <code class="language-plaintext highlighter-rouge">float</code> appears to fix the issue.</p>

<p>To make the address display a little better I wanted to add a popover for the marker. To do this I added <code class="language-plaintext highlighter-rouge">Feliz.Bulma.Popover</code> via paket and added <code class="language-plaintext highlighter-rouge">bulma-popover</code> via npm.</p>

<p>Reading the <a href="https://developer.mapquest.com/documentation/tools/link-to-mapquest/">MapQuest api docs</a> I could generate links to find directions by doing <code class="language-plaintext highlighter-rouge">sprintf "https://mapquest.com/latlng/%f,%f" a.Latitude a.Longitude</code>.</p>

<p>I was then able to render the information like:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp">    <span class="k">let</span> <span class="n">addressSection</span> <span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nc">AddressDetailModel</span> <span class="n">option</span><span class="p">)</span> <span class="p">=</span>

        <span class="k">let</span> <span class="n">tryReturnString</span> <span class="p">(</span><span class="n">optStr</span><span class="p">:</span> <span class="kt">string</span> <span class="n">option</span><span class="p">)</span> <span class="p">=</span>
            <span class="k">match</span> <span class="n">optStr</span> <span class="k">with</span>
            <span class="p">|</span> <span class="nc">None</span> <span class="p">-&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">empty</span>
            <span class="p">|</span> <span class="nc">Some</span> <span class="n">s</span> <span class="p">-&gt;</span> <span class="n">seq</span> <span class="p">{</span> <span class="k">yield</span> <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="n">s</span> <span class="p">}</span>

        <span class="k">let</span> <span class="n">stringOrEmpty</span> <span class="p">(</span><span class="n">optStr</span><span class="p">:</span> <span class="kt">string</span> <span class="n">option</span><span class="p">)</span> <span class="p">=</span>
            <span class="k">match</span> <span class="n">optStr</span> <span class="k">with</span>
            <span class="p">|</span> <span class="nc">None</span> <span class="p">-&gt;</span> <span class="nn">String</span><span class="p">.</span><span class="nc">Empty</span>
            <span class="p">|</span> <span class="nc">Some</span> <span class="n">s</span> <span class="p">-&gt;</span> <span class="n">s</span>

        <span class="k">let</span> <span class="n">formattedAddress</span> <span class="n">a</span> <span class="p">=</span>
           <span class="p">[</span> <span class="nn">Html</span><span class="p">.</span><span class="n">p</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span>
                     <span class="k">yield</span><span class="o">!</span> <span class="n">tryReturnString</span> <span class="n">a</span><span class="p">.</span><span class="nc">Address1</span>
                     <span class="k">yield</span><span class="o">!</span> <span class="n">tryReturnString</span> <span class="n">a</span><span class="p">.</span><span class="nc">Address2</span>
                     <span class="k">yield</span><span class="o">!</span> <span class="n">tryReturnString</span> <span class="n">a</span><span class="p">.</span><span class="nc">Address3</span>
                 <span class="p">]</span> <span class="p">]</span>
             <span class="nn">Html</span><span class="p">.</span><span class="n">p</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">text</span>  <span class="p">(</span><span class="n">sprintf</span> <span class="s2">"%s, %s, %s"</span> <span class="p">(</span><span class="n">stringOrEmpty</span> <span class="n">a</span><span class="p">.</span><span class="nc">City</span><span class="p">)</span> <span class="p">(</span><span class="n">stringOrEmpty</span> <span class="n">a</span><span class="p">.</span><span class="nc">State</span><span class="p">)</span> <span class="p">(</span><span class="n">stringOrEmpty</span> <span class="n">a</span><span class="p">.</span><span class="nc">Zipcode</span><span class="o">))</span>
             <span class="p">]</span> 
             <span class="nn">Html</span><span class="p">.</span><span class="n">p</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="p">(</span><span class="n">sprintf</span> <span class="s2">"LongLat: (%.2f, %.2f)"</span> <span class="n">a</span><span class="p">.</span><span class="nc">Longitude</span> <span class="n">a</span><span class="p">.</span><span class="nc">Latitude</span><span class="p">)</span> <span class="p">]</span> <span class="p">]</span>

        <span class="k">match</span> <span class="n">address</span> <span class="k">with</span>
        <span class="p">|</span> <span class="nc">None</span> <span class="p">-&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">empty</span>
        <span class="p">|</span> <span class="nc">Some</span> <span class="n">a</span> <span class="p">-&gt;</span>
            <span class="n">seq</span> <span class="p">{</span>
                <span class="k">yield</span>
                    <span class="nn">Bulma</span><span class="p">.</span><span class="n">section</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="s2">"Location"</span>
                                    <span class="nn">Html</span><span class="p">.</span><span class="n">p</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="k">yield</span> <span class="nn">PigeonMaps</span><span class="p">.</span><span class="n">map</span> <span class="p">[</span>
                                                                 <span class="n">map</span><span class="p">.</span><span class="n">center</span><span class="o">((</span><span class="kt">float</span> <span class="n">a</span><span class="p">.</span><span class="nc">Latitude</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">float</span> <span class="mi">0</span><span class="p">.</span><span class="mi">003</span><span class="o">),</span> <span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">.</span><span class="nc">Longitude</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">float</span> <span class="mi">0</span><span class="p">.</span><span class="mi">005</span><span class="o">))</span>
                                                                 <span class="n">map</span><span class="p">.</span><span class="n">zoom</span> <span class="mi">15</span>
                                                                 <span class="n">map</span><span class="p">.</span><span class="n">height</span> <span class="mi">350</span>
                                                                 <span class="n">map</span><span class="p">.</span><span class="n">markers</span> <span class="p">[</span>
                                                                     <span class="nn">PigeonMaps</span><span class="p">.</span><span class="n">marker</span> <span class="p">[</span>
                                                                         <span class="n">marker</span><span class="p">.</span><span class="n">anchor</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">.</span><span class="nc">Latitude</span><span class="p">,</span> <span class="kt">float</span> <span class="n">a</span><span class="p">.</span><span class="nc">Longitude</span><span class="p">)</span>
                                                                         <span class="n">marker</span><span class="p">.</span><span class="n">offsetLeft</span> <span class="mi">10</span>
                                                                         <span class="n">marker</span><span class="p">.</span><span class="n">offsetTop</span> <span class="mi">50</span>
                                                                         <span class="n">marker</span><span class="p">.</span><span class="n">render</span> <span class="p">(</span><span class="k">fun</span> <span class="n">marker</span> <span class="p">-&gt;</span> <span class="p">[</span>
                                                                            <span class="nn">Popover</span><span class="p">.</span><span class="n">popover</span> <span class="p">[</span>
                                                                                <span class="nn">Html</span><span class="p">.</span><span class="n">a</span> <span class="p">[</span>
                                                                                    <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span>
                                                                                        <span class="nn">Html</span><span class="p">.</span><span class="n">i</span> <span class="p">[</span>
                                                                                            <span class="k">if</span> <span class="n">marker</span><span class="p">.</span><span class="n">hovered</span>
                                                                                            <span class="k">then</span> <span class="n">prop</span><span class="p">.</span><span class="n">style</span> <span class="p">[</span> <span class="n">style</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">red</span><span class="p">;</span> <span class="n">style</span><span class="p">.</span><span class="n">cursor</span><span class="p">.</span><span class="n">pointer</span> <span class="p">]</span>
                                                                                            <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="p">[</span> <span class="s2">"fa"</span><span class="p">;</span> <span class="s2">"fa-map-marker"</span><span class="p">;</span> <span class="s2">"fa-2x"</span> <span class="p">]</span>
                                                                                        <span class="p">]</span> <span class="p">]</span>
                                                                                    <span class="n">popover</span><span class="p">.</span><span class="n">trigger</span>
                                                                                    <span class="n">prop</span><span class="p">.</span><span class="n">href</span> <span class="p">(</span><span class="n">sprintf</span> <span class="s2">"https://mapquest.com/latlng/%f,%f"</span> <span class="n">a</span><span class="p">.</span><span class="nc">Latitude</span> <span class="n">a</span><span class="p">.</span><span class="nc">Longitude</span><span class="p">)</span>
                                                                                    <span class="n">prop</span><span class="p">.</span><span class="n">target</span> <span class="s2">"_blank"</span>
                                                                                <span class="p">]</span>
                                                                                <span class="nn">Popover</span><span class="p">.</span><span class="n">content</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">card</span> <span class="p">[</span>
                                                                                    <span class="nn">Bulma</span><span class="p">.</span><span class="n">cardHeader</span> <span class="p">[</span>
                                                                                        <span class="nn">Bulma</span><span class="p">.</span><span class="n">cardHeaderTitle</span><span class="p">.</span><span class="n">p</span> <span class="n">model</span><span class="p">.</span><span class="nc">Name</span>
                                                                                    <span class="p">]</span>
                                                                                    <span class="nn">Bulma</span><span class="p">.</span><span class="n">cardContent</span> <span class="p">[</span>
                                                                                        <span class="nn">Bulma</span><span class="p">.</span><span class="n">content</span> <span class="p">(</span><span class="n">formattedAddress</span> <span class="n">a</span><span class="p">)</span>
                                                                                    <span class="p">]</span>
                                                                                <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>
                                                                         <span class="p">]</span> <span class="p">)</span>
                                                                     <span class="p">]</span>
                                                                 <span class="p">]</span>
                                                             <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>
                                    <span class="k">yield</span><span class="o">!</span> <span class="n">formattedAddress</span> <span class="n">a</span>
                                    <span class="nn">Html</span><span class="p">.</span><span class="n">p</span> <span class="p">[</span> <span class="nn">Html</span><span class="p">.</span><span class="n">a</span> <span class="p">[</span>
                                        <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="s2">"Find Directions"</span>
                                        <span class="n">popover</span><span class="p">.</span><span class="n">trigger</span>
                                        <span class="n">prop</span><span class="p">.</span><span class="n">href</span> <span class="p">(</span><span class="n">sprintf</span> <span class="s2">"https://mapquest.com/latlng/%f,%f"</span> <span class="n">a</span><span class="p">.</span><span class="nc">Latitude</span> <span class="n">a</span><span class="p">.</span><span class="nc">Longitude</span><span class="p">)</span>
                                        <span class="n">prop</span><span class="p">.</span><span class="n">target</span> <span class="s2">"_blank"</span>
                                    <span class="p">]</span>  <span class="p">]</span> <span class="p">]</span>
            <span class="p">}</span></code></pre></figure>

<p>This now appears to work (albeit with a clunky UI). One this I did notice is the the top menu does not work with small screens.</p>

<p>To fix this I added an id of “nav-menu” to the navbar menus and added a burger under the menu brand like:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">navBar</span> <span class="p">(</span><span class="n">dispatch</span><span class="p">:</span> <span class="nc">Msg</span> <span class="p">-&gt;</span> <span class="kt">unit</span><span class="p">)</span> <span class="p">=</span>

    <span class="nn">Html</span><span class="p">.</span><span class="n">div</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbar</span> <span class="p">[</span> <span class="n">color</span><span class="p">.</span><span class="n">isLight</span>
                                              <span class="n">navbar</span><span class="p">.</span><span class="n">isTransparent</span>
                                              <span class="n">navbar</span><span class="p">.</span><span class="n">hasShadow</span>
                                              <span class="n">navbar</span><span class="p">.</span><span class="n">isTransparent</span>
                                              <span class="n">prop</span><span class="p">.</span><span class="n">style</span> <span class="bp">[]</span>

                                              <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbarBrand</span><span class="p">.</span><span class="n">div</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbarItem</span><span class="p">.</span><span class="n">a</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">href</span>
                                                                                                               <span class="s2">"#/"</span>
                                                                                                           <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Html</span><span class="p">.</span><span class="n">h1</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">text</span>
                                                                                                                                         <span class="s2">"Wilkens Avenue"</span>
                                                                                                                                     <span class="n">prop</span><span class="p">.</span><span class="n">className</span>
                                                                                                                                         <span class="s2">"title navBarHeader"</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>

                                                                                      <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbarBurger</span> <span class="p">[</span>
                                                                                         <span class="n">prop</span><span class="p">.</span><span class="n">custom</span> <span class="p">(</span><span class="s2">"data-target"</span><span class="p">,</span> <span class="s2">"nav-menu"</span><span class="p">)</span>
                                                                                         <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span>
                                                                                             <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="p">[</span> <span class="p">]</span>
                                                                                             <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="p">[</span> <span class="p">]</span>
                                                                                             <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="p">[</span> <span class="p">]</span>
                                                                                         <span class="p">]</span>
                                                                                     <span class="o">]]</span>
                                                              
                                                              <span class="nn">Bulma</span><span class="p">.</span><span class="n">navbarMenu</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">id</span> <span class="s2">"nav-menu"</span>
                                                                                 <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span></code></pre></figure>

<p>I then copied the provided javascript to make the burger work from <a href="https://bulma.io/documentation/components/navbar/">Bulma site</a> to the index.html. This is a very messy solution but functions for now.</p>

<h2 id="results">Results</h2>

<p><a href="https://github.com/jamesclancy/WilkensAvenue/tree/step-17">Git branch for this step</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/bookreviews/2021/09/06/WinnieThePoohOnManagement/">
        Winnie-the-Pooh on Management by Rodger Allen
      </a>
    </h1>

    <span class="post-date">06 Sep 2021</span>

    <h2 id="easy-to-read-book-with-a-decent-overview-of-general-management-theory----710">Easy to read book with a decent overview of general management theory  - 7/10</h2>

<h2 id="summary">Summary</h2>

<p>The book tells the story of a mysterious stranger who meets Winnie the Pooh in the forest to discuss how management techniques are demonstrated in Pooh’s adventures and how these techniques may have improved their associated outcomes.</p>

<h2 id="my-impressions">My Impressions</h2>

<p>Overall the book isn’t really for me but was an easy and quick read. It clearly outlines the responsibilities of a manager i.e.:</p>

<ol>
  <li>Establish Objectives</li>
  <li>Organizing</li>
  <li>Motivating</li>
  <li>Developing</li>
  <li>Analysis</li>
</ol>

<p>and things like <code class="language-plaintext highlighter-rouge">SMART</code> Goals.</p>

<p>Overall, I think this would be a great token gift for a new manager or similar but probably is more of a token gift book vs a book someone should actually seek out and read on their own.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/projects/wilkensavenue/2021/09/05/WilkensAvenueStep16WireUpdateDescriptionToApi/">
        Wilkens Avenue - Step 16 - Wire Update Description to Api
      </a>
    </h1>

    <span class="post-date">05 Sep 2021</span>

    <h2 id="goals-of-this-step">Goals of this Step</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* Saving edits to the summary &amp; description on the Location Details page should fire an api to the backend server and display the error message if one is sent. 
</code></pre></div></div>

<h2 id="process">Process</h2>

<p>To wire this up I first created data transfer formats:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">LocationDetailUpdateRequest</span> <span class="p">=</span>
    <span class="p">{</span> <span class="nc">Id</span><span class="p">:</span> <span class="kt">string</span>
      <span class="nc">Summary</span><span class="p">:</span> <span class="kt">string</span>
      <span class="nc">Description</span><span class="p">:</span> <span class="kt">string</span> <span class="p">}</span>

<span class="k">type</span> <span class="nc">LocationDetailUpdateResult</span> <span class="p">=</span> <span class="p">{</span> <span class="nc">ErrorMessage</span><span class="p">:</span> <span class="kt">string</span> <span class="n">option</span> <span class="p">}</span></code></pre></figure>

<p>I then added an <code class="language-plaintext highlighter-rouge">updateLocationDetails</code> to the <code class="language-plaintext highlighter-rouge">ILocationInformationApi</code> like</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">ILocationInformationApi</span> <span class="p">=</span>
    <span class="p">{</span> <span class="n">getLocation</span><span class="p">:</span> <span class="kt">string</span> <span class="p">-&gt;</span> <span class="nc">Async</span><span class="p">&lt;</span><span class="nc">LocationDetailModel</span><span class="p">&gt;</span>
      <span class="n">searchLocations</span><span class="p">:</span> <span class="nc">LocationSearchRequest</span> <span class="p">-&gt;</span> <span class="nc">Async</span><span class="p">&lt;</span><span class="nc">LocationSearchResult</span><span class="p">&gt;</span>
      <span class="n">updateLocationDetails</span><span class="p">:</span> <span class="nc">LocationDetailUpdateRequest</span> <span class="p">-&gt;</span> <span class="nc">Async</span><span class="p">&lt;</span><span class="nc">LocationDetailUpdateResult</span><span class="p">&gt;</span> <span class="p">}</span></code></pre></figure>

<p>I update the server to return accept the request and return a response (but not actually do anything)</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">locationInformationApi</span> <span class="p">=</span>
    <span class="p">{</span> <span class="n">getLocation</span> <span class="p">=</span> <span class="k">fun</span> <span class="n">id</span> <span class="p">-&gt;</span> <span class="n">async</span> <span class="p">{</span> <span class="k">return</span> <span class="n">exampleLocation</span> <span class="p">}</span>
      <span class="n">searchLocations</span> <span class="p">=</span>
          <span class="o">...</span>
      <span class="n">updateLocationDetails</span> <span class="p">=</span> <span class="k">fun</span> <span class="n">req</span> <span class="p">-&gt;</span> <span class="n">async</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{</span> <span class="nc">ErrorMessage</span> <span class="p">=</span> <span class="nc">None</span> <span class="p">}</span> <span class="p">}</span>
    <span class="p">}</span></code></pre></figure>

<p>I added an <code class="language-plaintext highlighter-rouge">ErrorMessage</code> to the <code class="language-plaintext highlighter-rouge">UpdateLocationDetailState</code>:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">UpdateLocationDetailState</span> <span class="p">=</span>
    <span class="p">{</span> <span class="nc">EditingSummary</span><span class="p">:</span> <span class="kt">bool</span>
      <span class="nc">NewSummaryContent</span><span class="p">:</span> <span class="kt">string</span>
      <span class="nc">EditingDescription</span><span class="p">:</span> <span class="kt">bool</span>
      <span class="nc">NewDescriptionContent</span><span class="p">:</span> <span class="kt">string</span>
      <span class="nc">ErrorMessage</span><span class="p">:</span> <span class="kt">string</span> <span class="n">option</span> <span class="p">}</span></code></pre></figure>

<p>And I added a <code class="language-plaintext highlighter-rouge">LocationDetailUpdateServerResponseReceived</code> the client <code class="language-plaintext highlighter-rouge">Msg</code> type:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">Msg</span> <span class="p">=</span>
    <span class="p">|</span> <span class="nc">ReceivedLocationDetail</span> <span class="k">of</span> <span class="nc">LocationDetailModel</span>
    <span class="p">|</span> <span class="nc">BrowsePageFilterChanged</span> <span class="k">of</span> <span class="nc">BrowsePageFilterChange</span>
    <span class="p">|</span> <span class="nc">ReceivedBrowsePageResult</span> <span class="k">of</span> <span class="nc">BrowsePageModel</span>
    <span class="p">|</span> <span class="nc">LocationDetailUpdated</span> <span class="k">of</span> <span class="nc">LocationDetailUpdate</span>
    <span class="p">|</span> <span class="nc">LocationDetailUpdateServerResponseReceived</span> <span class="k">of</span> <span class="nc">LocationDetailModel</span> <span class="p">*</span> <span class="nc">UpdateLocationDetailState</span></code></pre></figure>

<p>I set up the mapping to create the request from the states and generate the new <code class="language-plaintext highlighter-rouge">LocationDetailUpdateServerResponseReceived</code> from the result:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">mapLocationDetailToEditRequest</span> <span class="p">(</span><span class="n">id</span><span class="p">:</span> <span class="kt">string</span><span class="p">)</span> <span class="n">currentEditState</span> <span class="p">=</span>
    <span class="p">{</span> <span class="nc">Id</span> <span class="p">=</span> <span class="n">id</span>
      <span class="nc">Summary</span> <span class="p">=</span> <span class="n">currentEditState</span><span class="p">.</span><span class="nc">NewSummaryContent</span>
      <span class="nc">Description</span> <span class="p">=</span> <span class="n">currentEditState</span><span class="p">.</span><span class="nc">NewDescriptionContent</span> <span class="p">}</span>

<span class="k">let</span> <span class="n">mapUpdateResultsToUpdateDetailResponseReceived</span>
    <span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="nc">LocationDetailUpdate</span><span class="p">)</span>
    <span class="p">(</span><span class="n">currPage</span><span class="p">:</span> <span class="nc">LocationDetailModel</span><span class="p">)</span>
    <span class="p">(</span><span class="n">editState</span><span class="p">:</span> <span class="nc">UpdateLocationDetailState</span><span class="p">)</span>
    <span class="n">response</span>
    <span class="p">=</span>

    <span class="p">(</span><span class="n">currPage</span><span class="p">,</span>
     <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span>
           <span class="nc">ErrorMessage</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="nc">ErrorMessage</span> <span class="o">})</span>
    <span class="p">|&gt;</span> <span class="nc">LocationDetailUpdateServerResponseReceived</span></code></pre></figure>

<p>In the LocationDetails, I then updated the <code class="language-plaintext highlighter-rouge">defaultEditState</code> to include the <code class="language-plaintext highlighter-rouge">ErrorMessage</code> and the <code class="language-plaintext highlighter-rouge">updateLocationDetailsModel</code> to also return a command which can trigger the result.</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">defaultEditState</span> <span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nc">LocationDetailModel</span><span class="p">)</span> <span class="p">:</span> <span class="nc">UpdateLocationDetailState</span> <span class="p">=</span>
    <span class="p">{</span> <span class="nc">EditingSummary</span> <span class="p">=</span> <span class="bp">false</span>
      <span class="nc">NewSummaryContent</span> <span class="p">=</span> <span class="n">stringEmptyOrValue</span> <span class="n">model</span><span class="p">.</span><span class="nc">Summary</span>
      <span class="nc">EditingDescription</span> <span class="p">=</span> <span class="bp">false</span>
      <span class="nc">NewDescriptionContent</span> <span class="p">=</span> <span class="n">stringEmptyOrValue</span> <span class="n">model</span><span class="p">.</span><span class="nc">Description</span>
      <span class="nc">ErrorMessage</span> <span class="p">=</span> <span class="nc">None</span> <span class="p">}</span>

<span class="k">let</span> <span class="n">updateLocationDetailsModel</span>
    <span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="nc">LocationDetailUpdate</span><span class="p">)</span>
    <span class="p">(</span><span class="n">currPage</span><span class="p">:</span> <span class="nc">LocationDetailModel</span><span class="p">)</span>
    <span class="p">(</span><span class="n">editState</span><span class="p">:</span> <span class="nc">UpdateLocationDetailState</span><span class="p">)</span>
    <span class="n">updateMethod</span>
    <span class="p">=</span>

    <span class="k">let</span> <span class="n">buildCmdForSave</span> <span class="p">=</span>
        <span class="nn">Cmd</span><span class="p">.</span><span class="nn">OfAsync</span><span class="p">.</span><span class="n">perform</span>
            <span class="n">updateMethod</span>
            <span class="p">(</span><span class="nn">ContractMappings</span><span class="p">.</span><span class="n">mapLocationDetailToEditRequest</span> <span class="n">currPage</span><span class="p">.</span><span class="nc">Id</span> <span class="n">editState</span><span class="p">)</span>
            <span class="p">(</span><span class="nn">ContractMappings</span><span class="p">.</span><span class="n">mapUpdateResultsToUpdateDetailResponseReceived</span> <span class="n">d</span> <span class="n">currPage</span> <span class="n">editState</span><span class="p">)</span>

    <span class="k">match</span> <span class="n">d</span> <span class="k">with</span>
    <span class="p">|</span> <span class="nc">SummaryStartEdit</span> <span class="p">-&gt;</span> <span class="n">currPage</span><span class="p">,</span> <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span> <span class="nc">EditingSummary</span> <span class="p">=</span> <span class="bp">true</span> <span class="o">},</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="nc">SummaryTextChanged</span> <span class="n">s</span> <span class="p">-&gt;</span>
        <span class="n">currPage</span><span class="p">,</span> <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span> <span class="nc">NewSummaryContent</span> <span class="p">=</span> <span class="n">s</span> <span class="o">},</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="nc">SummaryTextSaved</span> <span class="p">-&gt;</span>
        <span class="p">{</span> <span class="n">currPage</span> <span class="k">with</span>
              <span class="nc">Summary</span> <span class="p">=</span> <span class="nc">Some</span> <span class="n">editState</span><span class="p">.</span><span class="nc">NewSummaryContent</span> <span class="o">},</span>
        <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span>
              <span class="nc">EditingSummary</span> <span class="p">=</span> <span class="bp">false</span> <span class="o">},</span> <span class="n">buildCmdForSave</span>
    <span class="p">|</span> <span class="nc">SummaryTextChangeCanceled</span> <span class="p">-&gt;</span>
        <span class="n">currPage</span><span class="p">,</span>
        <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span>
              <span class="nc">EditingSummary</span> <span class="p">=</span> <span class="bp">false</span>
              <span class="nc">NewSummaryContent</span> <span class="p">=</span> <span class="n">stringEmptyOrValue</span> <span class="n">currPage</span><span class="p">.</span><span class="nc">Summary</span> <span class="o">},</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="nc">DescriptionStartEdit</span> <span class="p">-&gt;</span>
        <span class="n">currPage</span><span class="p">,</span>
        <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span>
              <span class="nc">EditingDescription</span> <span class="p">=</span> <span class="bp">true</span> <span class="o">},</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="nc">DescriptionTextChanged</span> <span class="n">s</span> <span class="p">-&gt;</span>
        <span class="n">currPage</span><span class="p">,</span>
        <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span>
              <span class="nc">NewDescriptionContent</span> <span class="p">=</span> <span class="n">s</span> <span class="o">},</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="nc">DescriptionTextSaved</span> <span class="p">-&gt;</span>
        <span class="p">{</span> <span class="n">currPage</span> <span class="k">with</span>
              <span class="nc">Description</span> <span class="p">=</span> <span class="nc">Some</span> <span class="n">editState</span><span class="p">.</span><span class="nc">NewDescriptionContent</span> <span class="o">},</span>
        <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span>
              <span class="nc">EditingDescription</span> <span class="p">=</span> <span class="bp">false</span> <span class="o">},</span> <span class="n">buildCmdForSave</span>
    <span class="p">|</span> <span class="nc">DescriptionTextChangeCanceled</span> <span class="p">-&gt;</span>
        <span class="n">currPage</span><span class="p">,</span>
        <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span>
              <span class="nc">EditingDescription</span> <span class="p">=</span> <span class="bp">false</span>
              <span class="nc">NewDescriptionContent</span> <span class="p">=</span> <span class="n">stringEmptyOrValue</span> <span class="n">currPage</span><span class="p">.</span><span class="nc">Description</span> <span class="o">},</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span></code></pre></figure>

<p>I update the view to display the error message if present like:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp">    <span class="k">let</span> <span class="n">errorMessage</span> <span class="p">(</span><span class="n">msg</span> <span class="p">:</span> <span class="kt">string</span> <span class="n">option</span><span class="p">)</span> <span class="p">=</span>
        <span class="k">match</span> <span class="n">msg</span> <span class="k">with</span>
        <span class="p">|</span> <span class="nc">None</span> <span class="p">-&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">empty</span>
        <span class="p">|</span> <span class="nc">Some</span> <span class="n">s</span> <span class="p">-&gt;</span> <span class="n">seq</span> <span class="p">{</span>
            <span class="nn">Bulma</span><span class="p">.</span><span class="n">notification</span> <span class="p">[</span>
                <span class="nn">Bulma</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">isDanger</span>
                <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">s</span>
                <span class="p">]</span>
            <span class="p">}</span>

    <span class="k">let</span> <span class="n">pageContent</span>
        <span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nc">LocationDetailModel</span><span class="p">)</span>
        <span class="p">(</span><span class="n">editState</span><span class="p">:</span> <span class="nc">UpdateLocationDetailState</span><span class="p">)</span>
        <span class="p">(</span><span class="n">dispatch</span><span class="p">:</span> <span class="nc">LocationDetailUpdate</span> <span class="p">-&gt;</span> <span class="kt">unit</span><span class="p">)</span>
        <span class="p">=</span>
        <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="p">[</span> <span class="n">title</span><span class="p">.</span><span class="n">is1</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"mb-5"</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">model</span><span class="p">.</span><span class="nc">Name</span> <span class="p">]</span>
          <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="p">[</span> <span class="n">title</span><span class="p">.</span><span class="n">is2</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"has-text-grey "</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">model</span><span class="p">.</span><span class="nc">SubTitle</span> <span class="p">]</span>
          <span class="k">yield</span><span class="o">!</span> <span class="n">errorMessage</span> <span class="n">editState</span><span class="p">.</span><span class="nc">ErrorMessage</span>
          <span class="k">yield</span><span class="o">!</span>
              <span class="n">editablePageSection</span>
              <span class="o">...</span></code></pre></figure>

<p>Lastly, I hooked this into the general index update function:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">update</span> <span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="nc">Msg</span><span class="p">)</span> <span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nc">Model</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Model</span> <span class="p">*</span> <span class="nc">Cmd</span><span class="p">&lt;</span><span class="nc">Msg</span><span class="p">&gt;</span> <span class="p">=</span>
    <span class="k">match</span> <span class="n">msg</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="nc">PageModel</span> <span class="k">with</span>
    <span class="p">|</span> <span class="nc">ReceivedLocationDetail</span> <span class="n">d</span><span class="p">,</span> <span class="p">_</span> <span class="p">-&gt;</span>
        <span class="n">modelWithNewPageModel</span>
            <span class="n">model</span>
            <span class="o">((</span><span class="n">d</span><span class="p">,</span> <span class="nn">Pages</span><span class="p">.</span><span class="nn">LocationDetails</span><span class="p">.</span><span class="n">defaultEditState</span> <span class="n">d</span><span class="p">)</span>
             <span class="p">|&gt;</span> <span class="nc">ViewLocationPageModel</span><span class="o">),</span>
        <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="nc">ReceivedBrowsePageResult</span> <span class="n">d</span><span class="p">,</span> <span class="p">_</span> <span class="p">-&gt;</span> <span class="n">modelWithNewPageModel</span> <span class="n">model</span> <span class="p">(</span><span class="n">d</span> <span class="p">|&gt;</span> <span class="nc">BrowsePageModel</span><span class="o">),</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="nc">BrowsePageFilterChanged</span> <span class="n">d</span><span class="p">,</span> <span class="p">_</span> <span class="p">-&gt;</span>
        <span class="p">(</span><span class="n">model</span><span class="p">,</span>
         <span class="p">(</span><span class="nn">Cmd</span><span class="p">.</span><span class="nn">OfAsync</span><span class="p">.</span><span class="n">perform</span>
             <span class="n">locationInformationApi</span><span class="p">.</span><span class="n">searchLocations</span>
             <span class="p">(</span><span class="n">mapBrowsePageFilterChangeToLocationSearchRequest</span> <span class="n">d</span><span class="p">)</span>
             <span class="n">mapSearchResultToReceievedBrowsePageResult</span><span class="o">))</span>
    <span class="p">|</span> <span class="nc">LocationDetailUpdated</span> <span class="n">d</span><span class="p">,</span> <span class="nc">ViewLocationPageModel</span> <span class="p">(</span><span class="n">currPage</span><span class="p">,</span> <span class="n">currentEditState</span><span class="p">)</span> <span class="p">-&gt;</span>
        <span class="k">let</span> <span class="p">(</span><span class="n">pm</span><span class="p">,</span><span class="n">ed</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span> <span class="p">=</span>  <span class="nn">Pages</span><span class="p">.</span><span class="nn">LocationDetails</span><span class="p">.</span><span class="n">updateLocationDetailsModel</span> <span class="n">d</span> <span class="n">currPage</span> <span class="n">currentEditState</span> <span class="n">locationInformationApi</span><span class="p">.</span><span class="n">updateLocationDetails</span>
        <span class="p">{</span> <span class="n">model</span> <span class="k">with</span>
              <span class="nc">PageModel</span> <span class="p">=</span>
                 <span class="p">(</span><span class="n">pm</span><span class="p">,</span> <span class="n">ed</span><span class="p">)</span>
                  <span class="p">|&gt;</span> <span class="nc">ViewLocationPageModel</span> <span class="o">},</span> <span class="n">cmd</span>

    <span class="p">|</span> <span class="o">_,</span> <span class="p">_</span> <span class="p">-&gt;</span> <span class="n">model</span><span class="p">,</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span></code></pre></figure>

<h2 id="results">Results</h2>

<p><a href="https://github.com/jamesclancy/WilkensAvenue/tree/step-16">Git branch for this step</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/projects/wilkensavenue/2021/09/04/WilkensAvenueStep15MockUpModifyDescription/">
        Wilkens Avenue - Step 15 - Mock Up Modify Description Modal
      </a>
    </h1>

    <span class="post-date">04 Sep 2021</span>

    <h2 id="goals-of-this-step">Goals of this Step</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* Mock up/ off a modal for the user to be able to modify descriptions of the locations. 
* This would be the functionality the user encountered when they click `Submit Update to Description` on the location details pages.  
</code></pre></div></div>

<h2 id="process">Process</h2>

<p>Doing some research Quill seams like a good way to add this functionality.  I found a <a href="https://dzoukr.github.io/Feliz.Quill/#/">Feliz.Quill module</a>.</p>

<p>using <code class="language-plaintext highlighter-rouge">femto install Feliz.Quill .\src\Client\Client.fsproj</code> failed with</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[05:12:41 INF] Found package.json in C:\tests\WilkensAvenue
[05:12:44 INF] Executing required actions for package resolution
[05:12:44 INF] Uninstalling [mocha]
[05:12:48 INF] Installing dependencies [react-quill@2.0.0-beta1, quill-blot-formatter@1.0.5]
[05:12:50 ERR] Error while installing react-quill@2.0.0-beta1, quill-blot-formatter@1.0.5
</code></pre></div></div>
<p>Mocha appears to have tried to uninstall mocha and install old versions of quill which are no longer available. This is undesirable behavior so I updated my packages.json to add mocha back and added <code class="language-plaintext highlighter-rouge">"react-quill": "^2.0.0-beta.4"</code> and <code class="language-plaintext highlighter-rouge">"quill-blot-formatter": "^1.0.5"</code> under the dependencies.</p>

<p>I then modified the <code class="language-plaintext highlighter-rouge">LocationDetails</code> page like</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="o">...</span>
    <span class="k">let</span> <span class="k">rec</span> <span class="n">editablePageSection</span> <span class="n">sectionTitle</span> <span class="n">previousValue</span> <span class="p">=</span>
        <span class="k">match</span> <span class="n">previousValue</span> <span class="k">with</span>
          <span class="p">|</span> <span class="nc">None</span> <span class="p">-&gt;</span> <span class="n">editablePageSection</span> <span class="n">sectionTitle</span> <span class="p">(</span><span class="nc">Some</span> <span class="s2">""</span><span class="p">)</span>
          <span class="p">|</span> <span class="nc">Some</span> <span class="n">s</span> <span class="p">-&gt;</span> 
                <span class="nn">Quill</span><span class="p">.</span><span class="n">editor</span> <span class="p">[</span>
                    <span class="n">editor</span><span class="p">.</span><span class="n">toolbar</span> <span class="p">[</span>
                        <span class="p">[</span> <span class="nc">Header</span> <span class="p">(</span><span class="nn">ToolbarHeader</span><span class="p">.</span><span class="nc">Dropdown</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">4</span><span class="o">])</span> <span class="p">]</span>
                        <span class="p">[</span> <span class="nc">ForegroundColor</span><span class="p">;</span> <span class="nc">BackgroundColor</span> <span class="p">]</span>
                        <span class="p">[</span> <span class="nc">Bold</span><span class="p">;</span> <span class="nc">Italic</span><span class="p">;</span> <span class="nc">Underline</span><span class="p">;</span> <span class="nc">Strikethrough</span><span class="p">;</span> <span class="nc">Blockquote</span><span class="p">;</span> <span class="nc">Code</span> <span class="p">]</span>
                        <span class="p">[</span> <span class="nc">OrderedList</span><span class="p">;</span> <span class="nc">UnorderedList</span><span class="p">;</span> <span class="nc">DecreaseIndent</span><span class="p">;</span> <span class="nc">IncreaseIndent</span><span class="p">;</span> <span class="nc">CodeBlock</span> <span class="p">]</span>
                    <span class="p">]</span>
                    <span class="n">editor</span><span class="p">.</span><span class="n">defaultValue</span> <span class="n">s</span>
                <span class="p">]</span>

    <span class="k">let</span> <span class="n">pageContent</span> <span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nc">LocationDetailModel</span><span class="p">)</span> <span class="p">=</span>
        <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="p">[</span> <span class="n">title</span><span class="p">.</span><span class="n">is1</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"mb-5"</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">model</span><span class="p">.</span><span class="nc">Name</span> <span class="p">]</span>
          <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="p">[</span> <span class="n">title</span><span class="p">.</span><span class="n">is2</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"has-text-grey "</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">model</span><span class="p">.</span><span class="nc">SubTitle</span> <span class="p">]</span>
          <span class="n">editablePageSection</span> <span class="s2">"Summary"</span> <span class="n">model</span><span class="p">.</span><span class="nc">Summary</span>
          <span class="n">editablePageSection</span> <span class="s2">"Description"</span> <span class="n">model</span><span class="p">.</span><span class="nn">Description</span>

<span class="p">...</span></code></pre></figure>

<p>and then I can see the rich text editors:</p>

<p><img src="\assets\img\post-media\2021-09-03-WilkensAvenueStep15MockUpModifyDescription\RTE-1.png" alt="Screenshot RTE-1" /></p>

<p>I need to make this toggle from editable to non-editable, add titles and maybe add a save button locally near the text you are editing.</p>

<p>After this I needed to add some way so toggle the editing on and off so I added a boolEditingEnabled like</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp">    <span class="k">let</span> <span class="k">rec</span> <span class="n">editablePageSection</span> <span class="p">(</span><span class="n">sectionTitle</span><span class="p">:</span> <span class="kt">string</span><span class="p">)</span> <span class="n">previousValue</span> <span class="n">boolEditingEnabled</span> <span class="p">=</span>
      <span class="k">match</span> <span class="n">previousValue</span> <span class="k">with</span>
      <span class="p">|</span> <span class="nc">None</span> <span class="p">-&gt;</span> <span class="n">editablePageSection</span> <span class="n">sectionTitle</span> <span class="p">(</span><span class="nc">Some</span> <span class="s2">""</span><span class="p">)</span> <span class="n">boolEditingEnabled</span>
      <span class="p">|</span> <span class="nc">Some</span> <span class="n">s</span> <span class="p">-&gt;</span>
        <span class="k">if</span> <span class="k">not</span> <span class="n">boolEditingEnabled</span> <span class="k">then</span> 
            <span class="n">seq</span> <span class="p">{</span>
                <span class="k">yield</span>
                    <span class="nn">Bulma</span><span class="p">.</span><span class="n">section</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="p">[</span><span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">sectionTitle</span><span class="o">];</span> <span class="nn">Html</span><span class="p">.</span><span class="n">i</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"fas fa-edit is-pulled-right"</span> <span class="p">]</span>  <span class="p">]</span> <span class="p">]</span>
                                                    <span class="nn">Html</span><span class="p">.</span><span class="n">p</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">s</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>
            <span class="p">}</span>
        <span class="k">else</span>
                 <span class="n">seq</span> <span class="p">{</span>
                            <span class="k">yield</span>
                                <span class="nn">Bulma</span><span class="p">.</span><span class="n">section</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">sectionTitle</span>  <span class="p">]</span>
                                                                <span class="nn">Quill</span><span class="p">.</span><span class="n">editor</span> <span class="p">[</span>
                                                                    <span class="n">editor</span><span class="p">.</span><span class="n">toolbar</span> <span class="p">[</span>
                                                                        <span class="p">[</span> <span class="nc">Header</span> <span class="p">(</span><span class="nn">ToolbarHeader</span><span class="p">.</span><span class="nc">Dropdown</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">4</span><span class="o">])</span> <span class="p">]</span>
                                                                        <span class="p">[</span> <span class="nc">ForegroundColor</span><span class="p">;</span> <span class="nc">BackgroundColor</span> <span class="p">]</span>
                                                                        <span class="p">[</span> <span class="nc">Bold</span><span class="p">;</span> <span class="nc">Italic</span><span class="p">;</span> <span class="nc">Underline</span><span class="p">;</span> <span class="nc">Strikethrough</span><span class="p">;</span> <span class="nc">Blockquote</span><span class="p">;</span> <span class="nc">Code</span> <span class="p">]</span>
                                                                        <span class="p">[</span> <span class="nc">OrderedList</span><span class="p">;</span> <span class="nc">UnorderedList</span><span class="p">;</span> <span class="nc">DecreaseIndent</span><span class="p">;</span> <span class="nc">IncreaseIndent</span><span class="p">;</span> <span class="nc">CodeBlock</span> <span class="p">]</span>
                                                                    <span class="p">]</span>
                                                                    <span class="n">editor</span><span class="p">.</span><span class="n">defaultValue</span> <span class="n">s</span>
                                                                    <span class="n">editor</span><span class="p">.</span><span class="n">onTextChanged</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="nn">Console</span><span class="p">.</span><span class="nc">WriteLine</span><span class="p">(</span><span class="n">x</span><span class="o">))</span>
                                                                <span class="p">]</span>
                                                                <span class="nn">Bulma</span><span class="p">.</span><span class="n">button</span><span class="p">.</span><span class="n">button</span> <span class="p">[</span>
                                                                    <span class="n">button</span><span class="p">.</span><span class="n">isLarge</span>
                                                                    <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="s2">"Save"</span>
                                                                <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>
                        <span class="p">}</span>

    <span class="k">let</span> <span class="n">pageContent</span> <span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nc">LocationDetailModel</span><span class="p">)</span> <span class="p">=</span>
        <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="p">[</span> <span class="n">title</span><span class="p">.</span><span class="n">is1</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"mb-5"</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">model</span><span class="p">.</span><span class="nc">Name</span> <span class="p">]</span>
          <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="p">[</span> <span class="n">title</span><span class="p">.</span><span class="n">is2</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"has-text-grey "</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">model</span><span class="p">.</span><span class="nc">SubTitle</span> <span class="p">]</span>
          <span class="k">yield</span><span class="o">!</span> <span class="n">editablePageSection</span> <span class="s2">"Summary"</span> <span class="n">model</span><span class="p">.</span><span class="nc">Summary</span> <span class="bp">true</span>
          <span class="k">yield</span><span class="o">!</span> <span class="n">editablePageSection</span> <span class="s2">"Description"</span> <span class="n">model</span><span class="p">.</span><span class="nc">Description</span> <span class="bp">false</span>
          <span class="k">yield</span><span class="o">!</span> <span class="n">addressSection</span> <span class="n">model</span><span class="p">.</span><span class="nc">Address</span>
          <span class="k">yield</span><span class="o">!</span> <span class="n">displayImages</span> <span class="n">model</span><span class="p">.</span><span class="nc">Images</span>
          <span class="k">yield</span><span class="o">!</span>
              <span class="n">modifyTextInParagraphOrYieldNothing</span>
                  <span class="s2">"has-text-grey mb-5"</span>
                  <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="s2">"Description from: "</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
                  <span class="n">model</span><span class="p">.</span><span class="nc">DescriptionCitation</span>
          <span class="nn">Html</span><span class="p">.</span><span class="n">div</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"buttons"</span>
                     <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Html</span><span class="p">.</span><span class="n">a</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"button is-primary"</span>
                                              <span class="n">prop</span><span class="p">.</span><span class="n">href</span> <span class="s2">"https://github.com/jamesclancy/WilkensAvenue"</span>
                                              <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="s2">"Find Directions"</span> <span class="p">]</span>
                                     <span class="nn">Html</span><span class="p">.</span><span class="n">a</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"button is-primary"</span>
                                              <span class="n">prop</span><span class="p">.</span><span class="n">href</span> <span class="s2">"https://github.com/jamesclancy/WilkensAvenue"</span>
                                              <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="s2">"Upload Images"</span> <span class="p">]</span>
                                     <span class="nn">Html</span><span class="p">.</span><span class="n">a</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"button is-primary"</span>
                                              <span class="n">prop</span><span class="p">.</span><span class="n">href</span> <span class="s2">"https://github.com/jamesclancy/WilkensAvenue"</span>
                                              <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="s2">"Submit Update to Description"</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span></code></pre></figure>

<p>This allows the “editable fields” to be toggled on and off. When off the user can click an edit icon (which doesn’t do anything at the moment) and save the results when editing which should save the results and shift the field into the uneditable state.</p>

<p>To actually wire this up I added a Client Msg subtype:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">LocationDetailUpdate</span> <span class="p">=</span>
    <span class="p">|</span> <span class="nc">SummaryStartEdit</span>
    <span class="p">|</span> <span class="nc">SummaryTextChanged</span> <span class="k">of</span> <span class="kt">string</span>
    <span class="p">|</span> <span class="nc">SummaryTextSaved</span>
    <span class="p">|</span> <span class="nc">SummaryTextChangeCanceled</span>
    <span class="p">|</span> <span class="nc">DescriptionStartEdit</span>
    <span class="p">|</span> <span class="nc">DescriptionTextChanged</span> <span class="k">of</span> <span class="kt">string</span>
    <span class="p">|</span> <span class="nc">DescriptionTextSaved</span>
    <span class="p">|</span> <span class="nc">DescriptionTextChangeCanceled</span>

<span class="k">type</span> <span class="nc">Msg</span> <span class="p">=</span>
    <span class="p">|</span> <span class="nc">ReceivedLocationDetail</span> <span class="k">of</span> <span class="nc">LocationDetailModel</span>
    <span class="p">|</span> <span class="nc">BrowsePageFilterChanged</span> <span class="k">of</span> <span class="nc">BrowsePageFilterChange</span>
    <span class="p">|</span> <span class="nc">ReceivedBrowsePageResult</span> <span class="k">of</span> <span class="nc">BrowsePageModel</span>
    <span class="p">|</span> <span class="nc">LocationDetailUpdated</span> <span class="k">of</span> <span class="nc">LocationDetailUpdate</span></code></pre></figure>

<p>I also added a type for the editor state and added it to the ViewLocationPageModel like:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">UpdateLocationDetailState</span> <span class="p">=</span>
    <span class="p">{</span>
        <span class="nc">EditingSummary</span><span class="p">:</span> <span class="kt">bool</span>
        <span class="nc">NewSummaryContent</span><span class="p">:</span> <span class="kt">string</span>
        <span class="nc">EditingDescription</span><span class="p">:</span> <span class="kt">bool</span>
        <span class="nc">NewDescriptionContent</span><span class="p">:</span> <span class="kt">string</span>
    <span class="p">}</span>

<span class="k">type</span> <span class="nc">PageModel</span> <span class="p">=</span>
    <span class="p">|</span> <span class="nc">HomePageModel</span>
    <span class="p">|</span> <span class="nc">FindPageModel</span> <span class="k">of</span> <span class="kt">string</span> <span class="p">*</span> <span class="kt">string</span> <span class="p">*</span> <span class="kt">int</span>
    <span class="p">|</span> <span class="nc">LogoutPageModel</span>
    <span class="p">|</span> <span class="nc">YourAccountPageModel</span>
    <span class="p">|</span> <span class="nc">EditLocationPageModel</span> <span class="k">of</span> <span class="kt">string</span>
    <span class="p">|</span> <span class="nc">ViewLocationPageModel</span> <span class="k">of</span> <span class="nc">LocationDetailModel</span> <span class="p">*</span> <span class="nc">UpdateLocationDetailState</span>
    <span class="p">|</span> <span class="nc">AboutPageModel</span>
    <span class="p">|</span> <span class="nc">NotFound</span>
    <span class="p">|</span> <span class="nc">Unauthorized</span>
    <span class="p">|</span> <span class="nc">LoadNextPage</span> <span class="k">of</span> <span class="nc">BrowseFilterModel</span>
    <span class="p">|</span> <span class="nc">LoadPreviousPage</span> <span class="k">of</span> <span class="nc">BrowseFilterModel</span></code></pre></figure>

<p>I then added a default edit model generator (for initial state) and an update function:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">stringEmptyOrValue</span> <span class="p">(</span><span class="n">s</span> <span class="p">:</span>  <span class="kt">string</span> <span class="n">option</span><span class="p">)</span> <span class="p">=</span>
    <span class="nn">Option</span><span class="p">.</span><span class="n">fold</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">y</span> <span class="p">-&gt;</span> <span class="n">x</span><span class="p">)</span> <span class="nn">String</span><span class="p">.</span><span class="nc">Empty</span> <span class="n">s</span>

<span class="k">let</span> <span class="n">defaultEditState</span> <span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nc">LocationDetailModel</span><span class="p">)</span> <span class="p">:</span> <span class="nc">UpdateLocationDetailState</span> <span class="p">=</span>
    <span class="p">{</span>
        <span class="nc">EditingSummary</span> <span class="p">=</span> <span class="bp">false</span>
        <span class="nc">NewSummaryContent</span> <span class="p">=</span> <span class="n">stringEmptyOrValue</span> <span class="n">model</span><span class="p">.</span><span class="nc">Summary</span>
        <span class="nc">EditingDescription</span><span class="p">=</span> <span class="bp">false</span>
        <span class="nc">NewDescriptionContent</span><span class="p">=</span> <span class="n">stringEmptyOrValue</span> <span class="n">model</span><span class="p">.</span><span class="nc">Description</span>
    <span class="p">}</span>

<span class="k">let</span> <span class="n">updateLocationDetailsModel</span>  <span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="nc">LocationDetailUpdate</span><span class="p">)</span> <span class="p">(</span><span class="n">currPage</span> <span class="p">:</span> <span class="nc">LocationDetailModel</span><span class="p">)</span> <span class="p">(</span><span class="n">editState</span> <span class="p">:</span> <span class="nc">UpdateLocationDetailState</span><span class="p">)</span> <span class="p">=</span>
    <span class="k">match</span> <span class="n">d</span> <span class="k">with</span>
    <span class="p">|</span> <span class="nc">SummaryStartEdit</span> <span class="p">-&gt;</span> <span class="n">currPage</span><span class="p">,</span> <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span> <span class="nc">EditingSummary</span> <span class="p">=</span> <span class="bp">true</span> <span class="p">}</span>
    <span class="p">|</span> <span class="nc">SummaryTextChanged</span> <span class="n">s</span><span class="p">-&gt;</span>
        <span class="nn">Console</span><span class="p">.</span><span class="nc">WriteLine</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">currPage</span><span class="p">,</span> <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span> <span class="nc">NewSummaryContent</span> <span class="p">=</span> <span class="n">s</span> <span class="p">}</span>
    <span class="p">|</span> <span class="nc">SummaryTextSaved</span> <span class="p">-&gt;</span>  <span class="p">{</span> <span class="n">currPage</span> <span class="k">with</span> <span class="nc">Summary</span> <span class="p">=</span> <span class="nc">Some</span> <span class="n">editState</span><span class="p">.</span><span class="nc">NewSummaryContent</span><span class="o">},</span> <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span> <span class="nc">EditingSummary</span> <span class="p">=</span> <span class="bp">false</span> <span class="p">}</span>
    <span class="p">|</span> <span class="nc">SummaryTextChangeCanceled</span> <span class="p">-&gt;</span> <span class="n">currPage</span><span class="p">,</span> <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span> <span class="nc">EditingSummary</span> <span class="p">=</span> <span class="bp">false</span><span class="p">;</span> <span class="nc">NewSummaryContent</span> <span class="p">=</span> <span class="n">stringEmptyOrValue</span> <span class="n">currPage</span><span class="p">.</span><span class="nc">Summary</span> <span class="p">}</span>
    <span class="p">|</span> <span class="nc">DescriptionStartEdit</span> <span class="p">-&gt;</span> <span class="n">currPage</span><span class="p">,</span> <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span> <span class="nc">EditingDescription</span> <span class="p">=</span> <span class="bp">true</span> <span class="p">}</span>
    <span class="p">|</span> <span class="nc">DescriptionTextChanged</span> <span class="n">s</span> <span class="p">-&gt;</span> <span class="n">currPage</span><span class="p">,</span> <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span> <span class="nc">NewDescriptionContent</span> <span class="p">=</span> <span class="n">s</span> <span class="p">}</span>
    <span class="p">|</span> <span class="nc">DescriptionTextSaved</span> <span class="p">-&gt;</span> <span class="p">{</span> <span class="n">currPage</span> <span class="k">with</span> <span class="nc">Description</span> <span class="p">=</span> <span class="nc">Some</span> <span class="n">editState</span><span class="p">.</span><span class="nc">NewDescriptionContent</span><span class="o">},</span> <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span> <span class="nc">EditingDescription</span> <span class="p">=</span> <span class="bp">false</span> <span class="p">}</span>
    <span class="p">|</span> <span class="nc">DescriptionTextChangeCanceled</span> <span class="p">-&gt;</span> <span class="n">currPage</span><span class="p">,</span> <span class="p">{</span> <span class="n">editState</span> <span class="k">with</span> <span class="nc">EditingDescription</span> <span class="p">=</span> <span class="bp">false</span><span class="p">;</span> <span class="nc">NewDescriptionContent</span> <span class="p">=</span> <span class="n">stringEmptyOrValue</span> <span class="n">currPage</span><span class="p">.</span><span class="nc">Description</span> <span class="p">}</span></code></pre></figure>

<p>I updated the main update functions/ message handling function to handle these new functionality:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">update</span> <span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="nc">Msg</span><span class="p">)</span> <span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nc">Model</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Model</span> <span class="p">*</span> <span class="nc">Cmd</span><span class="p">&lt;</span><span class="nc">Msg</span><span class="p">&gt;</span> <span class="p">=</span>
    <span class="k">match</span> <span class="n">msg</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="nc">PageModel</span> <span class="k">with</span>
    <span class="p">|</span> <span class="nc">ReceivedLocationDetail</span> <span class="n">d</span><span class="p">,</span> <span class="p">_</span> <span class="p">-&gt;</span> <span class="n">modelWithNewPageModel</span> <span class="n">model</span> <span class="p">(</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nn">Pages</span><span class="p">.</span><span class="nn">LocationDetails</span><span class="p">.</span><span class="n">defaultEditState</span> <span class="n">d</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="nc">ViewLocationPageModel</span><span class="o">),</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="nc">ReceivedBrowsePageResult</span> <span class="n">d</span><span class="p">,</span> <span class="p">_</span>  <span class="p">-&gt;</span> <span class="n">modelWithNewPageModel</span> <span class="n">model</span> <span class="p">(</span><span class="n">d</span> <span class="p">|&gt;</span> <span class="nc">BrowsePageModel</span><span class="o">),</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="nc">BrowsePageFilterChanged</span> <span class="n">d</span><span class="p">,</span> <span class="p">_</span>  <span class="p">-&gt;</span>
        <span class="p">(</span><span class="n">model</span><span class="p">,</span>
         <span class="p">(</span><span class="nn">Cmd</span><span class="p">.</span><span class="nn">OfAsync</span><span class="p">.</span><span class="n">perform</span>
             <span class="n">locationInformationApi</span><span class="p">.</span><span class="n">searchLocations</span>
             <span class="p">(</span><span class="n">mapBrowsePageFilterChangeToLocationSearchRequsst</span> <span class="n">d</span><span class="p">)</span>
             <span class="n">mapSearchResultToReceievedBrowsePageResult</span><span class="o">))</span>
    <span class="p">|</span> <span class="nc">LocationDetailUpdated</span> <span class="n">d</span><span class="p">,</span> <span class="nc">ViewLocationPageModel</span> <span class="p">(</span><span class="n">currPage</span><span class="p">,</span> <span class="n">currentEditState</span><span class="p">)</span>  <span class="p">-&gt;</span>
       <span class="p">{</span> <span class="n">model</span> <span class="k">with</span> <span class="nc">PageModel</span> <span class="p">=</span> <span class="nn">Pages</span><span class="p">.</span><span class="nn">LocationDetails</span><span class="p">.</span><span class="n">updateLocationDetailsModel</span> <span class="n">d</span> <span class="n">currPage</span> <span class="n">currentEditState</span> <span class="p">|&gt;</span> <span class="nc">ViewLocationPageModel</span> <span class="o">},</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>
    <span class="p">|</span> <span class="o">_,</span> <span class="p">_</span>  <span class="p">-&gt;</span> <span class="n">model</span><span class="p">,</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span>

<span class="k">let</span> <span class="n">view</span> <span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nc">Model</span><span class="p">)</span> <span class="p">(</span><span class="n">dispatch</span><span class="p">:</span> <span class="nc">Msg</span> <span class="p">-&gt;</span> <span class="kt">unit</span><span class="p">)</span> <span class="p">=</span>
    <span class="k">match</span> <span class="n">model</span><span class="p">.</span><span class="nc">PageModel</span> <span class="k">with</span>
    <span class="p">|</span> <span class="nc">HomePageModel</span> <span class="p">-&gt;</span> <span class="n">homeView</span> <span class="n">dispatch</span>
    <span class="p">|</span> <span class="nc">LoadingScreenPageModel</span> <span class="p">-&gt;</span> <span class="nn">SharedComponents</span><span class="p">.</span><span class="n">loadingScreen</span>
    <span class="p">|</span> <span class="nc">ViewLocationPageModel</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">locationDetailView</span> <span class="n">d</span> <span class="n">e</span> <span class="n">dispatch</span>
    <span class="p">|</span> <span class="nc">BrowsePageModel</span> <span class="n">bpm</span> <span class="p">-&gt;</span> <span class="n">browseView</span> <span class="n">bpm</span> <span class="n">dispatch</span>
    <span class="p">|</span> <span class="nc">NotFound</span> <span class="p">-&gt;</span> <span class="n">str</span> <span class="s2">"404"</span>
    <span class="p">|</span> <span class="p">_</span> <span class="p">-&gt;</span> <span class="n">str</span> <span class="s2">"???"</span></code></pre></figure>

<p>Finally, I update the view to publish these message and reflect the bool is editing value like:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp">    <span class="k">let</span> <span class="k">rec</span> <span class="n">editablePageSection</span> <span class="p">(</span><span class="n">sectionTitle</span><span class="p">:</span> <span class="kt">string</span><span class="p">)</span> <span class="n">previousValue</span> <span class="n">boolEditingEnabled</span> <span class="p">(</span><span class="n">editFunction</span><span class="p">:</span> <span class="kt">string</span> <span class="p">-&gt;</span> <span class="kt">unit</span><span class="p">)</span> <span class="p">(</span><span class="n">saveChanges</span><span class="p">:</span> <span class="kt">unit</span> <span class="p">-&gt;</span> <span class="kt">unit</span><span class="p">)</span> <span class="p">(</span><span class="n">cancelChanges</span><span class="p">:</span>  <span class="kt">unit</span> <span class="p">-&gt;</span> <span class="kt">unit</span><span class="p">)</span> <span class="p">(</span><span class="n">startEditing</span><span class="p">:</span>  <span class="kt">unit</span> <span class="p">-&gt;</span> <span class="kt">unit</span><span class="p">)</span>  <span class="p">=</span> 
      <span class="k">match</span> <span class="n">previousValue</span> <span class="k">with</span>
      <span class="p">|</span> <span class="nc">None</span> <span class="p">-&gt;</span> <span class="n">editablePageSection</span> <span class="n">sectionTitle</span> <span class="p">(</span><span class="nc">Some</span> <span class="s2">""</span><span class="p">)</span> <span class="n">boolEditingEnabled</span> <span class="n">editFunction</span> <span class="n">saveChanges</span> <span class="n">cancelChanges</span> <span class="n">startEditing</span>
      <span class="p">|</span> <span class="nc">Some</span> <span class="n">s</span> <span class="p">-&gt;</span>
        <span class="k">if</span> <span class="k">not</span> <span class="n">boolEditingEnabled</span> <span class="k">then</span> 
            <span class="n">seq</span> <span class="p">{</span>
                <span class="k">yield</span>
                    <span class="nn">Bulma</span><span class="p">.</span><span class="n">section</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span>
                                                                        <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="p">[</span><span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">sectionTitle</span><span class="o">];</span>
                                                                        <span class="nn">Html</span><span class="p">.</span><span class="n">i</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"fas fa-edit is-pulled-right"</span>
                                                                                 <span class="n">prop</span><span class="p">.</span><span class="n">onClick</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="n">startEditing</span> <span class="bp">()</span><span class="o">)]</span>  <span class="p">]</span> <span class="p">]</span>
                                                    <span class="nn">Html</span><span class="p">.</span><span class="n">p</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">innerHtml</span> <span class="n">s</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>
            <span class="p">}</span>
        <span class="k">else</span>
                 <span class="n">seq</span> <span class="p">{</span>
                            <span class="k">yield</span>
                                <span class="nn">Bulma</span><span class="p">.</span><span class="n">section</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">sectionTitle</span>  <span class="p">]</span>
                                                                <span class="nn">Quill</span><span class="p">.</span><span class="n">editor</span> <span class="p">[</span>
                                                                    <span class="n">editor</span><span class="p">.</span><span class="n">toolbar</span> <span class="p">[</span>
                                                                        <span class="p">[</span> <span class="nc">Header</span> <span class="p">(</span><span class="nn">ToolbarHeader</span><span class="p">.</span><span class="nc">Dropdown</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">4</span><span class="o">])</span> <span class="p">]</span>
                                                                        <span class="p">[</span> <span class="nc">ForegroundColor</span><span class="p">;</span> <span class="nc">BackgroundColor</span> <span class="p">]</span>
                                                                        <span class="p">[</span> <span class="nc">Bold</span><span class="p">;</span> <span class="nc">Italic</span><span class="p">;</span> <span class="nc">Underline</span><span class="p">;</span> <span class="nc">Strikethrough</span><span class="p">;</span> <span class="nc">Blockquote</span><span class="p">;</span> <span class="nc">Code</span> <span class="p">]</span>
                                                                        <span class="p">[</span> <span class="nc">OrderedList</span><span class="p">;</span> <span class="nc">UnorderedList</span><span class="p">;</span> <span class="nc">DecreaseIndent</span><span class="p">;</span> <span class="nc">IncreaseIndent</span><span class="p">;</span> <span class="nc">CodeBlock</span> <span class="p">]</span>
                                                                    <span class="p">]</span>
                                                                    <span class="n">editor</span><span class="p">.</span><span class="n">defaultValue</span> <span class="n">s</span>
                                                                    <span class="n">editor</span><span class="p">.</span><span class="n">onTextChanged</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="n">editFunction</span> <span class="n">x</span><span class="p">)</span>
                                                                <span class="p">]</span>
                                                                <span class="nn">Bulma</span><span class="p">.</span><span class="n">field</span><span class="p">.</span><span class="n">div</span> <span class="p">[</span>
                                                                    <span class="nn">Bulma</span><span class="p">.</span><span class="n">field</span><span class="p">.</span><span class="n">hasAddons</span>
                                                                    <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span>
                                                                        <span class="nn">Bulma</span><span class="p">.</span><span class="n">control</span><span class="p">.</span><span class="n">p</span> <span class="p">[</span>
                                                                            <span class="nn">Bulma</span><span class="p">.</span><span class="n">button</span><span class="p">.</span><span class="n">button</span> <span class="p">[</span>
                                                                                <span class="nn">Bulma</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">isSuccess</span>
                                                                                <span class="n">prop</span><span class="p">.</span><span class="n">onClick</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="n">saveChanges</span> <span class="bp">()</span><span class="p">)</span>
                                                                                <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span>
                                                                                    <span class="nn">Bulma</span><span class="p">.</span><span class="n">icon</span> <span class="p">[</span> <span class="nn">Html</span><span class="p">.</span><span class="n">i</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"fas fa-save"</span> <span class="p">]</span> <span class="p">]</span>
                                                                                    <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="s2">"Save"</span> <span class="p">]</span> <span class="p">]</span>
                                                                            <span class="p">]</span>
                                                                        <span class="p">]</span>
                                                                        <span class="nn">Bulma</span><span class="p">.</span><span class="n">control</span><span class="p">.</span><span class="n">p</span> <span class="p">[</span>
                                                                            <span class="nn">Bulma</span><span class="p">.</span><span class="n">button</span><span class="p">.</span><span class="n">button</span> <span class="p">[</span>
                                                                                <span class="nn">Bulma</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">isWarning</span>
                                                                                <span class="n">prop</span><span class="p">.</span><span class="n">onClick</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="n">cancelChanges</span> <span class="bp">()</span><span class="p">)</span>
                                                                                <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span>
                                                                                    <span class="nn">Bulma</span><span class="p">.</span><span class="n">icon</span> <span class="p">[</span> <span class="nn">Html</span><span class="p">.</span><span class="n">i</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"fas fa-trash"</span> <span class="p">]</span> <span class="p">]</span>
                                                                                    <span class="nn">Html</span><span class="p">.</span><span class="n">span</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="s2">"Cancel"</span> <span class="p">]</span> <span class="p">]</span>
                                                                            <span class="p">]</span>
                                                                        <span class="p">]</span>
                                                                    <span class="p">]</span>
                                                                <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>
                        <span class="p">}</span>

    <span class="k">let</span> <span class="n">pageContent</span> <span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nc">LocationDetailModel</span><span class="p">)</span> <span class="p">(</span><span class="n">editState</span> <span class="p">:</span> <span class="nc">UpdateLocationDetailState</span><span class="p">)</span> <span class="p">(</span><span class="n">dispatch</span><span class="p">:</span> <span class="nc">LocationDetailUpdate</span> <span class="p">-&gt;</span> <span class="kt">unit</span><span class="o">)=</span>
        <span class="p">[</span> <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="p">[</span> <span class="n">title</span><span class="p">.</span><span class="n">is1</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"mb-5"</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">model</span><span class="p">.</span><span class="nc">Name</span> <span class="p">]</span>
          <span class="nn">Bulma</span><span class="p">.</span><span class="n">title</span> <span class="p">[</span> <span class="n">title</span><span class="p">.</span><span class="n">is2</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"has-text-grey "</span>
                        <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="n">model</span><span class="p">.</span><span class="nc">SubTitle</span> <span class="p">]</span>
          <span class="k">yield</span><span class="o">!</span> <span class="n">editablePageSection</span> <span class="s2">"Summary"</span> <span class="n">model</span><span class="p">.</span><span class="nc">Summary</span> <span class="n">editState</span><span class="p">.</span><span class="nc">EditingSummary</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="n">x</span> <span class="p">|&gt;</span> <span class="nc">SummaryTextChanged</span> <span class="p">|&gt;</span> <span class="n">dispatch</span><span class="p">)</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="nc">SummaryTextSaved</span> <span class="p">|&gt;</span> <span class="n">dispatch</span><span class="p">)</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="nc">SummaryTextChangeCanceled</span> <span class="p">|&gt;</span> <span class="n">dispatch</span><span class="p">)</span>  <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="nc">SummaryStartEdit</span> <span class="p">|&gt;</span> <span class="n">dispatch</span><span class="p">)</span>
          <span class="k">yield</span><span class="o">!</span> <span class="n">editablePageSection</span> <span class="s2">"Description"</span> <span class="n">model</span><span class="p">.</span><span class="nc">Description</span> <span class="n">editState</span><span class="p">.</span><span class="nc">EditingDescription</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="n">x</span> <span class="p">|&gt;</span> <span class="nc">DescriptionTextChanged</span> <span class="p">|&gt;</span> <span class="n">dispatch</span><span class="p">)</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="nc">DescriptionTextSaved</span> <span class="p">|&gt;</span> <span class="n">dispatch</span><span class="p">)</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="nc">DescriptionTextChangeCanceled</span> <span class="p">|&gt;</span> <span class="n">dispatch</span><span class="p">)</span>  <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="nc">DescriptionStartEdit</span> <span class="p">|&gt;</span> <span class="n">dispatch</span><span class="p">)</span>
          <span class="k">yield</span><span class="o">!</span> <span class="n">addressSection</span> <span class="n">model</span><span class="p">.</span><span class="nc">Address</span>
          <span class="k">yield</span><span class="o">!</span> <span class="n">displayImages</span> <span class="n">model</span><span class="p">.</span><span class="nc">Images</span>
          <span class="k">yield</span><span class="o">!</span>
              <span class="n">modifyTextInParagraphOrYieldNothing</span>
                  <span class="s2">"has-text-grey mb-5"</span>
                  <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="s2">"Description from: "</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
                  <span class="n">model</span><span class="p">.</span><span class="nc">DescriptionCitation</span>
          <span class="nn">Html</span><span class="p">.</span><span class="n">div</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"buttons"</span>
                     <span class="n">prop</span><span class="p">.</span><span class="n">children</span> <span class="p">[</span> <span class="nn">Html</span><span class="p">.</span><span class="n">a</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"button is-primary"</span>
                                              <span class="n">prop</span><span class="p">.</span><span class="n">href</span> <span class="s2">"https://github.com/jamesclancy/WilkensAvenue"</span>
                                              <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="s2">"Find Directions"</span> <span class="p">]</span>
                                     <span class="nn">Html</span><span class="p">.</span><span class="n">a</span> <span class="p">[</span> <span class="n">prop</span><span class="p">.</span><span class="n">className</span> <span class="s2">"button is-primary"</span>
                                              <span class="n">prop</span><span class="p">.</span><span class="n">href</span> <span class="s2">"https://github.com/jamesclancy/WilkensAvenue"</span>
                                              <span class="n">prop</span><span class="p">.</span><span class="n">text</span> <span class="s2">"Upload Images"</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span></code></pre></figure>

<p>One thing that wasn’t 100% clear here from the documentation was to set hte <code class="language-plaintext highlighter-rouge">innerHtml</code> prop on the p. This might be clear to someone with more ReactJS experience but I had to spend some time googling to determine what to do.</p>

<p>This needs to be refactored and actually hooked up to the backend but I am ending the step here.</p>

<h2 id="results">Results</h2>

<p><a href="https://github.com/jamesclancy/WilkensAvenue/tree/step-15">Git branch for this step</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/bookreviews/2021/09/04/IstheUniverseAHologram/">
        Is the Universe a Hologram? by Adolfo Plasencia
      </a>
    </h1>

    <span class="post-date">04 Sep 2021</span>

    <h2 id="this-book-was-boring-repetitive-and-hard-to-get-through---210">This book was boring, repetitive and hard to get through. - 2/10</h2>

<h2 id="summary">Summary</h2>

<p>The book is written in a question and answer format where the author <em>Plasencia</em> interviews scientists and academics about philosophical issues relating to their work. May of the discussions centered around how the internet was providing a way for people to become more and more connected.</p>

<h2 id="my-impressions">My Impressions</h2>

<p>Overall the general prose of the book was poorly written. I am not certain if the text was intentionally written in a <em>simple</em> way, but it ended sounding like it was written by a freshman high school student and not very engaging.</p>

<p>None of the topics were discussed in great detail and many of the topics were repetitive if people making references to <em>Web 2.0</em> over and over. Most QA sessions were &lt; 10 pages including and intro and notes meaning &lt; 7-8 pages of content. This meant that the expert would just respond to the generic, yet profound sounding, question on a very surface level and chapter would end.</p>

<p>Additionally, the book is very pro-MIT. It was published by MIT Press so I would assume it would show MIT in a positive light but this book seemed like a vehicle for MIT to pat itself on the back.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/recipes/2021/09/03/PeanutButterAndNavyBeanSpread/">
        Peanut Butter and Navy Bean Spread
      </a>
    </h1>

    <span class="post-date">03 Sep 2021</span>

    <p>Peanut Butter and Navy Bean Spread</p>

<h2 id="ingredients">Ingredients</h2>

<ul>
  <li>1 can navy beans</li>
  <li>1 can diced tomatoes</li>
  <li>2 table spoons powdered peanut butter</li>
  <li>1/2 teaspoon garlic powder</li>
  <li>1/2 teaspoon onion powder</li>
  <li>1/2 teaspoon pepper</li>
</ul>

<h2 id="yield">Yield</h2>

<p>~ 4 servings</p>

<h2 id="process">Process</h2>

<ol>
  <li>Mix everything together</li>
  <li>Mash it up</li>
  <li>Chill till thickened</li>
</ol>

<h2 id="results">Results</h2>

<p>7/10 - This was pretty good and went pretty well on flatbread. It was a little bit more interesting tasting then a pb&amp;j and probably less work to make.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/projects/wilkensavenue/2021/09/01/WilkensAvenueStep14FixingWebpackDevServer/">
        Wilkens Avenue - Step 14 - Fixing a number of the Dependabot Upgrades
      </a>
    </h1>

    <span class="post-date">01 Sep 2021</span>

    <h2 id="goals-of-this-step">Goals of this Step</h2>
<ul>
  <li>Update webpack-cli</li>
  <li>Update webpack-dev-server</li>
</ul>

<h2 id="process">Process</h2>

<p>The Dependabot flagged upgrades for <code class="language-plaintext highlighter-rouge">webpack-cli</code> and <code class="language-plaintext highlighter-rouge">webpack-dev-server</code>. These are important and large upgrades which introduced breaking changes (even though Dependabot said dev server was 100% compatible.)</p>

<p>First I updated the packages.json file to later version of these two libraries like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        "webpack-cli": "^4.8.0",
        "webpack-dev-server": "^4.0.0"
</code></pre></div></div>

<p>This caused <code class="language-plaintext highlighter-rouge">dotnet run</code> to fail catastrophically when trying to start the client.</p>

<p>To more quickly troubleshoot the problems I switched to running <code class="language-plaintext highlighter-rouge">npx webpack-dev-server --config webpack.config.js</code></p>

<p>This gave me a number of issues to step through with the configuration:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\tests\WilkensAvenue&gt; npx webpack-dev-server --config webpack.config.js
[webpack-cli] Invalid options object. Dev Server has been initialized using an options object that does not match the API schema.
 - options has an unknown property 'inline'. These properties are valid:
   object { allowedHosts?, bonjour?, client?, compress?, devMiddleware?, headers?, historyApiFallback?, host?, hot?, http2?, https?, ipc?, liveReload?, magicHtml?, onAfterSetupMiddleware?, onBeforeSetupMiddleware?, onListening?, open?, port?, proxy?, setupExitSignals?, static?, watchFiles?, webSocketServer? }
PS C:\tests\WilkensAvenue&gt; npx webpack-dev-server --config webpack.config.js
Bundling for development...
[webpack-cli] Invalid options object. Dev Server has been initialized using an options object that does not match the API schema.
 - options has an unknown property 'contentBase'. These properties are valid:
   object { allowedHosts?, bonjour?, client?, compress?, devMiddleware?, headers?, historyApiFallback?, host?, hot?, http2?, https?, ipc?, liveReload?, magicHtml?, onAfterSetupMiddleware?, onBeforeSetupMiddleware?, onListening?, open?, port?, proxy?, setupExitSignals?, static?, watchFiles?, webSocketServer? }
PS C:\tests\WilkensAvenue&gt; npx webpack-dev-server --config webpack.config.js
Bundling for development...
[webpack-cli] Invalid options object. Dev Server has been initialized using an options object that does not match the API schema.
 - options has an unknown property 'publicPath'. These properties are valid:
   object { allowedHosts?, bonjour?, client?, compress?, devMiddleware?, headers?, historyApiFallback?, host?, hot?, http2?, https?, ipc?, liveReload?, magicHtml?, onAfterSetupMiddleware?, onBeforeSetupMiddleware?, onListening?, open?, port?, proxy?, setupExitSignals?, static?, watchFiles?, webSocketServer? }
</code></pre></div></div>

<ul>
  <li>I removed the <code class="language-plaintext highlighter-rouge">inline</code> property from <code class="language-plaintext highlighter-rouge">module.exports.devServer</code> in <code class="language-plaintext highlighter-rouge">webpack.config.js</code></li>
  <li>I switched <code class="language-plaintext highlighter-rouge">contentBase</code> to <code class="language-plaintext highlighter-rouge">static</code> in  <code class="language-plaintext highlighter-rouge">module.exports.devServer</code> in <code class="language-plaintext highlighter-rouge">webpack.config.js</code></li>
  <li>I removed <code class="language-plaintext highlighter-rouge">publicPath</code>  from <code class="language-plaintext highlighter-rouge">module.exports.devServer</code> in <code class="language-plaintext highlighter-rouge">webpack.config.js</code></li>
</ul>

<p>Now <code class="language-plaintext highlighter-rouge">npx webpack-dev-server --config webpack.config.js</code> is working but <code class="language-plaintext highlighter-rouge">dotnet run</code> still fails with a:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>client: WARNING in configuration
client: The 'mode' option has not been set, webpack will fallback to 'production' for this value. Set 'mode' option to 'development' or 'production' to enable defaults for each environment.
client: You can also set it to 'none' to disable any default behavior. Learn more: https://webpack.js.org/configuration/mode/
client: ERROR in Entry module not found: Error: Can't resolve './src' in 'C:\tests\WilkensAvenue\src\Client'
client: ERROR in multi (webpack)-dev-server/client?protocol=ws%3A&amp;hostname=0.0.0.0&amp;port=8080&amp;pathname=%2Fws&amp;logging=info (webpack)/hot/dev-server.js ./src
client: Module not found: Error: Can't resolve './src' in 'C:\tests\WilkensAvenue\src\Client'
client:  @ multi (webpack)-dev-server/client?protocol=ws%3A&amp;hostname=0.0.0.0&amp;port=8080&amp;pathname=%2Fws&amp;logging=info (webpack)/hot/dev-server.js ./src main[2]
</code></pre></div></div>

<p>This appears to be because the dev server is no longer pulling in the correct configuration by default. To remedy this I update the <code class="language-plaintext highlighter-rouge">Build.fs</code> file changing the run definition from:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Target.create "Run" (fun _ -&gt;
    run dotnet "build" sharedPath
    [ "server", dotnet "watch run" serverPath
      "client", dotnet "fable watch --run webpack-dev-server" clientPath ]
    |&gt; runParallel
)
</code></pre></div></div>

<p>to</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Target.create "Run" (fun _ -&gt;
    run dotnet "build" sharedPath
    [ "server", dotnet "watch run" serverPath
      "client", dotnet "fable watch --run webpack-dev-server --config ../../webpack.config.js" clientPath ]
    |&gt; runParallel
)
</code></pre></div></div>

<p>and <code class="language-plaintext highlighter-rouge">dotnet run</code> now works again.</p>

<p>Now it looks like dotnet run Bundle fails with</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>client: .&gt; cmd /C ..\..\node_modules\.bin\webpack -p
client: [webpack-cli] Error: Unknown option '-p'
client: [webpack-cli] Run 'webpack --help' to see available commands and options
client: Run process failed
Finished (Failed) 'Bundle' in 00:00:21.3183767
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Bundle</code> was defined as</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Target.create "Bundle" (fun _ -&gt;
    [ "server", dotnet $"publish -c Release -o \"{deployPath}\"" serverPath
      "client", dotnet "fable --run webpack -p" clientPath ]
    |&gt; runParallel
)
</code></pre></div></div>

<p>To fix the command I had to switch out the <code class="language-plaintext highlighter-rouge">-p</code> with ` –mode production –env production<code class="language-plaintext highlighter-rouge"> and also explicitly specify the configuration with a </code>–config ../../webpack.config.js<code class="language-plaintext highlighter-rouge">. The led to the </code>Bundle` being replaced with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Target.create "Bundle" (fun _ -&gt;
    [ "server", dotnet $"publish -c Release -o \"{deployPath}\"" serverPath
      "client", dotnet "fable --run webpack --mode production --env production --config ../../webpack.config.js" clientPath ]
    |&gt; runParallel
)
</code></pre></div></div>

<p>Now <code class="language-plaintext highlighter-rouge">dotnet run Bundle</code> works.</p>

<h2 id="results">Results</h2>

<p><a href="https://github.com/jamesclancy/WilkensAvenue/tree/step-14">Git branch for this step</a></p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page9">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page7">Newer</a>
    
  
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
